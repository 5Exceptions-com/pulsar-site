#! /bin/sh

# function create_index() {
#     cat >build-$1/$1.md/index.html <<EOF
# <!DOCTYPE html>
# <html>
#   <head>
#     <meta charset="UTF-8">
#     <meta http-equiv="refresh" content="0; url=/docs/$1/">
#     <link rel="canonical" href="/docs/$1/" />
#   </head>
#   <script>
#     window.location.href = '/docs/$1/';
#   </script>
# </html>
# EOF
# }

node scripts/split-version.js

latest=$(cat scripts/.latest)

while read version; do
    echo $version "build begin..."
    echo "[\"${latest}\", \"${version}\"]" >versions.json
    yarn build
    mkdir -p build-${version}/${version} build-${version}/${version}.md
    cp -r build/docs/${version}/* build-${version}/${version}
    cp -r build/docs/${version}.md/* build-${version}/${version}.md
    # create_index $version
    echo $version "build done..."
done <scripts/.versions

# echo $latest "build begin..."
# echo "[\"${latest}\"]" >versions.json
# yarn build

while read version; do
    mv build-$version/* build/docs
    rm -rf build-$version
done <scripts/.versions
