<!doctype html>
<html class="docs-version-2.8.0" lang="zh-TW" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/zh-TW/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-TW/blog/atom.xml" title="Apache Pulsar Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Pulsar" href="/zh-TW/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;400;600&display=swap">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">How transactions work? | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.org/zh-TW/docs/2.8.0/txn-how"><meta data-react-helmet="true" name="docsearch:language" content="zh-TW"><meta data-react-helmet="true" name="docsearch:version" content="2.8.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-2.8.0"><meta data-react-helmet="true" property="og:title" content="How transactions work? | Apache Pulsar"><meta data-react-helmet="true" name="description" content="This section describes transaction components and how the components work together. For the complete design details, see PIP-31: Transactional Streaming."><meta data-react-helmet="true" property="og:description" content="This section describes transaction components and how the components work together. For the complete design details, see PIP-31: Transactional Streaming."><link data-react-helmet="true" rel="icon" href="/zh-TW/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.org/zh-TW/docs/2.8.0/txn-how"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/docs/2.8.0/txn-how" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/zh-CN/docs/2.8.0/txn-how" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/zh-TW/docs/2.8.0/txn-how" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/ja/docs/2.8.0/txn-how" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/fr/docs/2.8.0/txn-how" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/ko/docs/2.8.0/txn-how" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/docs/2.8.0/txn-how" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-TW/assets/css/styles.e23c3d15.css">
<link rel="preload" href="/zh-TW/assets/js/runtime~main.5618dbf6.js" as="script">
<link rel="preload" href="/zh-TW/assets/js/main.f156af9f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-TW/"><div class="navbar__logo"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/zh-TW/docs/2.8.0/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link navbar__link--active" href="/zh-TW/docs/2.8.0/about">Quickstart</a></li><li><a class="dropdown__link" href="/zh-TW/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/zh-TW/docs/2.8.0/about">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/zh-TW/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/zh-TW/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/zh-TW/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/zh-TW/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/zh-TW/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/zh-TW/community#governance">Governance</a></li><li><a class="dropdown__link" href="/zh-TW/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/zh-TW/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/blog">Blog</a></li><li><a class="dropdown__link" href="/zh-TW/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/zh-TW/resources">Resources</a></li><li><a class="dropdown__link" href="/zh-TW/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文（台灣）</span></span></a><ul class="dropdown__menu"><li><a href="/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（中国）</a></li><li><a href="/zh-TW/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">中文（台灣）</a></li><li><a href="/ja/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/fr/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link">Français</a></li><li><a href="/ko/docs/2.8.0/txn-how" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh-TW/docs">Version</a><ul class="dropdown__menu"><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.0</span></a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-TW/docs/2.8.0/about">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/concepts-overview">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/schema-get-started">Pulsar Schema</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/functions-overview">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/io-overview">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/sql-overview">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/tiered-storage-overview">Tiered Storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/zh-TW/docs/2.8.0/txn-why">Transactions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-TW/docs/2.8.0/txn-why">Why transactions?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-TW/docs/2.8.0/txn-what">What are transactions?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-TW/docs/2.8.0/txn-how">How transactions work?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-TW/docs/2.8.0/txn-use">How to use transactions?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-TW/docs/2.8.0/txn-monitor">How to monitor transactions?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/helm-overview">Kubernetes (Helm)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/deploy-aws">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/administration-zk-bk">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/security-overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/performance-pulsar-perf">Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/client-libraries">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/admin-api-overview">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/adaptors-kafka">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/cookbooks-compaction">Cookbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/develop-tools">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-TW/docs/2.8.0/reference-terminology">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache Pulsar<!-- --> <b>2.8.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/zh-TW/docs/txn-how">latest version</a></b> (<!-- -->2.9.1<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.8.0</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How transactions work?</h1></header><p>This section describes transaction components and how the components work together. For the complete design details, see <a href="https://docs.google.com/document/d/145VYp09JKTw9jAT-7yNyFU255FptB2_B2Fye100ZXDI/edit#heading=h.bm5ainqxosrx" target="_blank" rel="noopener noreferrer">PIP-31: Transactional Streaming</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="key-concept">Key concept<a class="hash-link" href="#key-concept" title="Direct link to heading">​</a></h2><p>It is important to know the following key concepts, which is a prerequisite for understanding how transactions work.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transaction-coordinator">Transaction coordinator<a class="hash-link" href="#transaction-coordinator" title="Direct link to heading">​</a></h3><p>The transaction coordinator (TC) is a module running inside a Pulsar broker.</p><ul><li><p>It maintains the entire life cycle of transactions and prevents a transaction from getting into an incorrect status.</p></li><li><p>It handles transaction timeout, and ensures that the transaction is aborted after a transaction timeout.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transaction-log">Transaction log<a class="hash-link" href="#transaction-log" title="Direct link to heading">​</a></h3><p>All the transaction metadata persists in the transaction log. The transaction log is backed by a Pulsar topic. If the transaction coordinator crashes, it can restore the transaction metadata from the transaction log.</p><p>The transaction log stores the transaction status rather than actual messages in the transaction (the actual messages are stored in the actual topic partitions).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transaction-buffer">Transaction buffer<a class="hash-link" href="#transaction-buffer" title="Direct link to heading">​</a></h3><p>Messages produced to a topic partition within a transaction are stored in the transaction buffer (TB) of that topic partition. The messages in the transaction buffer are not visible to consumers until the transactions are committed. The messages in the transaction buffer are discarded when the transactions are aborted.</p><p>Transaction buffer stores all ongoing and aborted transactions in memory. All messages are sent to the actual partitioned Pulsar topics.  After transactions are committed, the messages in the transaction buffer are materialized (visible) to consumers. When the transactions are aborted, the messages in the transaction buffer are discarded.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="transaction-id">Transaction ID<a class="hash-link" href="#transaction-id" title="Direct link to heading">​</a></h3><p>Transaction ID (TxnID) identifies a unique transaction in Pulsar. The transaction ID is 128-bit. The highest 16 bits are reserved for the ID of the transaction coordinator, and the remaining bits are used for monotonically increasing numbers in each transaction coordinator. It is easy to locate the transaction crash with the TxnID.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="pending-acknowledge-state">Pending acknowledge state<a class="hash-link" href="#pending-acknowledge-state" title="Direct link to heading">​</a></h3><p>Pending acknowledge state maintains message acknowledgments within a transaction before a transaction completes. If a message is in the pending acknowledge state, the message cannot be acknowledged by other transactions until the message is removed from the pending acknowledge state.</p><p>The pending acknowledge state is persisted to the pending acknowledge log (cursor ledger). A new broker can restore the state from the pending acknowledge log to ensure the acknowledgement is not lost.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="data-flow">Data flow<a class="hash-link" href="#data-flow" title="Direct link to heading">​</a></h2><p>At a high level, the data flow can be split into several steps:</p><ol><li><p>Begin a transaction.</p></li><li><p>Publish messages with a transaction.</p></li><li><p>Acknowledge messages with a transaction.</p></li><li><p>End a transaction.</p></li></ol><p>To help you debug or tune the transaction for better performance, review the following diagrams and descriptions.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-begin-a-transaction">1. Begin a transaction<a class="hash-link" href="#1-begin-a-transaction" title="Direct link to heading">​</a></h3><p>Before introducing the transaction in Pulsar, a producer is created and then messages are sent to brokers and stored in data logs.</p><p><img src="/zh-TW/assets/images/txn-3-751a2bc51f91299f6c546b647c2f632c.png"></p><p>Let’s walk through the steps for <em>beginning a transaction</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>1.1</td><td>The first step is that the Pulsar client finds the transaction coordinator.</td></tr><tr><td>1.2</td><td>The transaction coordinator allocates a transaction ID for the transaction. In the transaction log, the transaction is logged with its transaction ID and status (OPEN), which ensures the transaction status is persisted regardless of transaction coordinator crashes.</td></tr><tr><td>1.3</td><td>The transaction log sends the result of persisting the transaction ID to the transaction coordinator.</td></tr><tr><td>1.4</td><td>After the transaction status entry is logged, the transaction coordinator brings the transaction ID back to the Pulsar client.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-publish-messages-with-a-transaction">2. Publish messages with a transaction<a class="hash-link" href="#2-publish-messages-with-a-transaction" title="Direct link to heading">​</a></h3><p>In this stage, the Pulsar client enters a transaction loop, repeating the <code>consume-process-produce</code> operation for all the messages that comprise the transaction. This is a long phase and is potentially composed of multiple produce and acknowledgement requests.</p><p><img src="/zh-TW/assets/images/txn-4-f7adc6fb4ff184199a981fc32dd2311e.png"></p><p>Let’s walk through the steps for <em>publishing messages with a transaction</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>2.1.1</td><td>Before the Pulsar client produces messages to a new topic partition, it sends a request to the transaction coordinator to add the partition to the transaction.</td></tr><tr><td>2.1.2</td><td>The transaction coordinator logs the partition changes of the transaction into the transaction log for durability, which ensures the transaction coordinator knows all the partitions that a transaction is handling. The transaction coordinator can commit or abort changes on each partition at the end-partition phase.</td></tr><tr><td>2.1.3</td><td>The transaction log sends the result of logging the new partition (used for producing messages) to the transaction coordinator.</td></tr><tr><td>2.1.4</td><td>The transaction coordinator sends the result of adding a new produced partition to the transaction.</td></tr><tr><td>2.2.1</td><td>The Pulsar client starts producing messages to partitions. The flow of this part is the same as the normal flow of producing messages except that the batch of messages produced by a transaction contains transaction IDs.</td></tr><tr><td>2.2.2</td><td>The broker writes messages to a partition.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3-acknowledge-messages-with-a-transaction">3. Acknowledge messages with a transaction<a class="hash-link" href="#3-acknowledge-messages-with-a-transaction" title="Direct link to heading">​</a></h3><p>In this phase, the Pulsar client sends a request to the transaction coordinator and a new subscription is acknowledged as a part of a transaction.</p><p><img src="/zh-TW/assets/images/txn-5-66e33b5b6ba3d900a1635cb268a38b35.png"></p><p>Let’s walk through the steps for <em>acknowledging messages with a transaction</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>3.1.1</td><td>The Pulsar client sends a request to add an acknowledged subscription to the transaction coordinator.</td></tr><tr><td>3.1.2</td><td>The transaction coordinator logs the addition of subscription, which ensures that it knows all subscriptions handled by a transaction and can commit or abort changes on each subscription at the end phase.</td></tr><tr><td>3.1.3</td><td>The transaction log sends the result of logging the new partition (used for acknowledging messages) to the transaction coordinator.</td></tr><tr><td>3.1.4</td><td>The transaction coordinator sends the result of adding the new acknowledged partition to the transaction.</td></tr><tr><td>3.2</td><td>The Pulsar client acknowledges messages on the subscription. The flow of this part is the same as the normal flow of acknowledging messages except that the acknowledged request carries a transaction ID.</td></tr><tr><td>3.3</td><td>The broker receiving the acknowledgement request checks if the acknowledgment belongs to a transaction or not.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4-end-a-transaction">4. End a transaction<a class="hash-link" href="#4-end-a-transaction" title="Direct link to heading">​</a></h3><p>At the end of a transaction, the Pulsar client decides to commit or abort the transaction. The transaction can be aborted when a conflict is detected on acknowledging messages.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="41-end-transaction-request">4.1 End transaction request<a class="hash-link" href="#41-end-transaction-request" title="Direct link to heading">​</a></h4><p>When the Pulsar client finishes a transaction, it issues an end transaction request.</p><p><img src="/zh-TW/assets/images/txn-6-ac44126d5410be548e44717d2cc056fa.png"></p><p>Let’s walk through the steps for <em>ending the transaction</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>4.1.1</td><td>The Pulsar client issues an end transaction request (with a field indicating whether the transaction is to be committed or aborted) to the transaction coordinator.</td></tr><tr><td>4.1.2</td><td>The transaction coordinator writes a COMMITTING or ABORTING message to its transaction log.</td></tr><tr><td>4.1.3</td><td>The transaction log sends the result of logging the committing or aborting status.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_y2LR" id="42-finalize-a-transaction">4.2 Finalize a transaction<a class="hash-link" href="#42-finalize-a-transaction" title="Direct link to heading">​</a></h4><p>The transaction coordinator starts the process of committing or aborting messages to all the partitions involved in this transaction.</p><p><img src="/zh-TW/assets/images/txn-7-229fdd1904b8c411e77d48fe1c3fee65.png"></p><p>Let’s walk through the steps for <em>finalizing a transaction</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>4.2.1</td><td>The transaction coordinator commits transactions on subscriptions and commits transactions on partitions at the same time.</td></tr><tr><td>4.2.2</td><td>The broker (produce) writes produced committed markers to the actual partitions. At the same time, the broker (ack) writes acked committed marks to the subscription pending ack partitions.</td></tr><tr><td>4.2.3</td><td>The data log sends the result of writing produced committed marks to the broker. At the same time, pending ack data log sends the result of writing acked committed marks to the broker. The cursor moves to the next position.</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_y2LR" id="43-mark-a-transaction-as-committed-or-aborted">4.3 Mark a transaction as COMMITTED or ABORTED<a class="hash-link" href="#43-mark-a-transaction-as-committed-or-aborted" title="Direct link to heading">​</a></h4><p>The transaction coordinator writes the final transaction status to the transaction log to complete the transaction.</p><p><img src="/zh-TW/assets/images/txn-8-d49405f853142c9762c4caaa8f862b4e.png"></p><p>Let’s walk through the steps for <em>marking a transaction as COMMITTED or ABORTED</em>.</p><table><thead><tr><th>Step</th><th>Description</th></tr></thead><tbody><tr><td>4.3.1</td><td>After all produced messages and acknowledgements to all partitions involved in this transaction have been successfully committed or aborted, the transaction coordinator writes the final COMMITTED or ABORTED transaction status messages to its transaction log, indicating that the transaction is complete. All the messages associated with the transaction in its transaction log can be safely removed.</td></tr><tr><td>4.3.2</td><td>The transaction log sends the result of the committed transaction to the transaction coordinator.</td></tr><tr><td>4.3.3</td><td>The transaction coordinator sends the result of the committed transaction to the Pulsar client.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.8.0/txn-how.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-TW/docs/2.8.0/txn-what"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">What are transactions?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-TW/docs/2.8.0/txn-use"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to use transactions?</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-concept" class="table-of-contents__link toc-highlight">Key concept</a><ul><li><a href="#transaction-coordinator" class="table-of-contents__link toc-highlight">Transaction coordinator</a></li><li><a href="#transaction-log" class="table-of-contents__link toc-highlight">Transaction log</a></li><li><a href="#transaction-buffer" class="table-of-contents__link toc-highlight">Transaction buffer</a></li><li><a href="#transaction-id" class="table-of-contents__link toc-highlight">Transaction ID</a></li><li><a href="#pending-acknowledge-state" class="table-of-contents__link toc-highlight">Pending acknowledge state</a></li></ul></li><li><a href="#data-flow" class="table-of-contents__link toc-highlight">Data flow</a><ul><li><a href="#1-begin-a-transaction" class="table-of-contents__link toc-highlight">1. Begin a transaction</a></li><li><a href="#2-publish-messages-with-a-transaction" class="table-of-contents__link toc-highlight">2. Publish messages with a transaction</a></li><li><a href="#3-acknowledge-messages-with-a-transaction" class="table-of-contents__link toc-highlight">3. Acknowledge messages with a transaction</a></li><li><a href="#4-end-a-transaction" class="table-of-contents__link toc-highlight">4. End a transaction</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/zh-TW/"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/zh-TW/assets/js/runtime~main.5618dbf6.js"></script>
<script src="/zh-TW/assets/js/main.f156af9f.js"></script>
</body>
</html>