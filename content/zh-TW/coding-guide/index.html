<!doctype html>
<html lang="zh-TW" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/zh-TW/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-TW/blog/atom.xml" title="Apache Pulsar Atom Feed">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">Coding Guide | Apache Pulsar</title><meta data-react-helmet="true" property="og:title" content="Coding Guide | Apache Pulsar"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/zh-TW/coding-guide"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-TW"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="icon" href="/zh-TW/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/zh-TW/coding-guide"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/coding-guide" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-CN/coding-guide" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-TW/coding-guide" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ja/coding-guide" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/fr/coding-guide" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ko/coding-guide" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/coding-guide" hreflang="x-default"><link rel="stylesheet" href="/zh-TW/assets/css/styles.7be061a7.css">
<link rel="preload" href="/zh-TW/assets/js/runtime~main.325e2a24.js" as="script">
<link rel="preload" href="/zh-TW/assets/js/main.98c45c67.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-TW/"><div class="navbar__logo"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/docs/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link" href="/zh-TW/docs/about">Quickstart</a></li><li><a class="dropdown__link" href="/zh-TW/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link" href="/zh-TW/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/zh-TW/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/zh-TW/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/zh-TW/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/zh-TW/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/zh-TW/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/zh-TW/community#governance">Governance</a></li><li><a class="dropdown__link" href="/zh-TW/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/zh-TW/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/blog">Blog</a></li><li><a class="dropdown__link" href="/zh-TW/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/zh-TW/resources">Resources</a></li><li><a class="dropdown__link" href="/zh-TW/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文（台灣）</span></span></a><ul class="dropdown__menu"><li><a href="/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（中国）</a></li><li><a href="/zh-TW/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">中文（台灣）</a></li><li><a href="/ja/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/fr/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link">Français</a></li><li><a href="/ko/coding-guide" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/zh-TW/docs">Version</a><ul class="dropdown__menu"><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.3</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.4</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.3</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.2.0</span></a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mdx-wrapper mdx-page"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_eQvw"><div class="col"><header><h1>Coding Guide</h1></header><p>The guidelines help to encourage consistency and best practices among people working on <em>Apache Pulsar</em> code base. You should observe the guidelines unless there is compelling reason to ignore them. We use checkstyle to enforce coding style, refer to our <a href="https://github.com/apache/pulsar/blob/master/buildtools/src/main/resources/pulsar/checkstyle.xml" target="_blank" rel="noopener noreferrer">checkstyle rules</a> for all enforced checkstyle rules.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="java">Java<a class="hash-link" href="#java" title="Direct link to heading">​</a></h2><p>Apache Pulsar code follows the <a href="http://www.oracle.com/technetwork/java/javase/documentation/codeconvtoc-136057.html" target="_blank" rel="noopener noreferrer">Sun Java Coding Convention</a>, with the following additions.</p><ul><li>Lines can not be longer than 120 characters.</li><li>Indentation should be <strong>4 spaces</strong>. Tabs should never be used.</li><li>Use curly braces even for single-line ifs and elses.</li><li>No @author tags in any javadoc.</li><li>Use try-with-resources blocks whenever is possible.</li><li><strong>TODO</strong>s should be associated to at least one issue. </li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="dependencies">Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">​</a></h2><p>Apache Pulsar uses the following libraries a lot:</p><ul><li><a href="https://github.com/google/guava" target="_blank" rel="noopener noreferrer">Guava</a>: as a fundamental core library</li><li><a href="http://netty.io/" target="_blank" rel="noopener noreferrer">Netty</a>: for network communications and memory buffer management.</li></ul><p>Use these libraries whenever possible rather than introducing more dependencies. </p><p>Dependencies are bundled with our binary distributions, so we need to attach the relevant licenses. See <a href="https://pulsar.apache.org/docs/en/client-libraries/" target="_blank" rel="noopener noreferrer">Third party dependencies and licensing</a> for a guide on how to do it correctly.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="future">Future<a class="hash-link" href="#future" title="Direct link to heading">​</a></h2><p>Java-8 Future is preferred over Guava&#x27;s Listenable Future. Use Java-8 Future whenever possible.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="memory">Memory<a class="hash-link" href="#memory" title="Direct link to heading">​</a></h2><p>Use netty <em>ByteBuf</em> over java nio <em>ByteBuffer</em> for internal usage. As we are using Netty Buffer for memory management.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">​</a></h2><ul><li>Logging should be taken seriously. Please take the time to access the logs when making a change to ensure that the important things are getting logged and there is no junk there.</li><li>Logging statements should be complete sentences with proper capitalization that are written to be read by a person not necessarily familiar with the source code.</li><li>All loggings should be done with <strong>SLF4j</strong>, never <em>System.out</em> or <em>System.err</em>.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="logging-levels">Logging levels<a class="hash-link" href="#logging-levels" title="Direct link to heading">​</a></h3><ul><li><em>INFO</em> is the level you should assume the software will be run in. INFO messages are things which are not bad but which the user will definitely want to know about every time they occur.</li><li><em>TRACE</em> and <em>DEBUG</em> are both things you turn on when something is wrong and you want to figure out what is going on. <em>DEBUG</em> should not be so fine grained that it will seriously affect performance of the program. <em>TRACE</em> can be anything. You should wrap <em>DEBUG</em> and <em>TRACE</em> statements in the <code>if (logger.isDebugEnabled)</code> or <code>if (logger.isTraceEnabled)</code> check to avoid performance degradation.</li><li><em>WARN</em> and <em>ERROR</em> indicate something that is <strong>BAD</strong>. Use <em>WARN</em> if you aren&#x27;t totally sure it is bad, and <em>ERROR</em> if you are.</li></ul><p>Log the <em>stack traces</em> at <strong>ERROR</strong> level, but never at <strong>INFO</strong> level or below. You can log at <strong>WARN</strong> level if you are interested in debugging.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="monitoring">Monitoring<a class="hash-link" href="#monitoring" title="Direct link to heading">​</a></h2><ul><li>Any new features should come with appropriate metrics, so monitoring the feature is working correctly.</li><li>Those metrics should be taken seriously and only export useful metrics that would be used on production on monitoring/alerting healthy of the system, or troubleshooting problems.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="unit-tests">Unit tests<a class="hash-link" href="#unit-tests" title="Direct link to heading">​</a></h2><ul><li>New changes should come with unit tests that verify the functionality being added.</li><li>Unit tests should test the least amount of code possible. Don&#x27;t start the whole server unless there is no other way to test a single class or small group of classes in isolation.</li><li>Tests should not depend on any external resources. They need to setup and teardown their own stuff.</li><li>It is okay to use the filesystem and network in tests since that&#x27;s our business, but you need to clean up them after test.</li><li><em>Do not</em> use sleep or other timing assumptions in tests. It is wrong and will fail intermittently on any test server with other things going on that causes delays.</li><li>You&#x27;d better add a <em>timeout</em> value to all test cases, to prevent a build from completing indefinitely. For example, <code>@Test(timeout=60000)</code></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h2><ul><li>When you use the config files, think of the names from the very beginning.</li><li>If you run the program without tuning parameters, use the default values.</li><li>All configuration settings should be added accordingly in the <a href="https://github.com/apache/pulsar/tree/master/conf" target="_blank" rel="noopener noreferrer">default configuration file</a> directory and documented accordingly.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="concurrency">Concurrency<a class="hash-link" href="#concurrency" title="Direct link to heading">​</a></h2><p>Apache Pulsar is a low latency system, it is implemented as a purely asynchronous service, which is accomplished as follows:</p><ul><li>All public classes should be <strong>thread-safe</strong>.</li><li>We prefer using <a href="https://github.com/apache/bookkeeper/blob/master/bookkeeper-common/src/main/java/org/apache/bookkeeper/common/util/OrderedExecutor.java" target="_blank" rel="noopener noreferrer">OrderedExecutor</a> for executing any asynchronous actions. The mutations to the same instance should be submitted to the same thread to execute.</li><li>If synchronization and locking are required, they should be in a fine granularity way.</li><li>All threads should have proper meaningful name.</li><li>If a class is not thread-safe, it should be annotated <a href="https://github.com/misberner/jsr-305/blob/master/ri/src/main/java/javax/annotation/concurrent/NotThreadSafe.java" target="_blank" rel="noopener noreferrer">@NotThreadSafe</a>. The instances that use this class is responsible for its synchronization.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="backwards-compatibility">Backwards compatibility<a class="hash-link" href="#backwards-compatibility" title="Direct link to heading">​</a></h2><ul><li>Wire protocol should support backwards compatibility to enable no-downtime upgrades. This means the servers <strong>MUST</strong> be able to support requests from both old and new clients simultaneously.</li><li>Metadata formats and data formats should support backwards compatibility.</li></ul></div></div></main></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/zh-TW/"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Inc.Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/zh-TW/assets/js/runtime~main.325e2a24.js"></script>
<script src="/zh-TW/assets/js/main.98c45c67.js"></script>
</body>
</html>