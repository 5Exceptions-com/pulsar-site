"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[74642],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return f}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=p(a),f=r,c=u["".concat(s,".").concat(f)]||u[f]||m[f]||o;return a?n.createElement(c,l(l({ref:t},d),{},{components:a})):n.createElement(c,l({ref:t},d))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},72360:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(67294),r=a(86010),o="tabItem_OmH5";function l(e){var t=e.children,a=e.hidden,l=e.className;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,l),hidden:a},t)}},9877:function(e,t,a){a.d(t,{Z:function(){return f}});var n=a(87462),r=a(67294),o=a(72389),l=a(67392),i=a(7094),s=a(12466),p=a(86010),d="tabList_uSqn",m="tabItem_LplD";function u(e){var t,a,o,u=e.lazy,f=e.block,c=e.defaultValue,h=e.values,k=e.groupId,g=e.className,N=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=h?h:N.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),y=(0,l.l)(v,(function(e,t){return e.value===t.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===c?c:null!=(t=null!=c?c:null==(a=N.find((function(e){return e.props.default})))?void 0:a.props.value)?t:null==(o=N[0])?void 0:o.props.value;if(null!==b&&!v.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var w=(0,i.U)(),C=w.tabGroupChoices,S=w.setTabGroupChoices,x=(0,r.useState)(b),O=x[0],P=x[1],M=[],T=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=k){var z=C[k];null!=z&&z!==O&&v.some((function(e){return e.value===z}))&&P(z)}var D=function(e){var t=e.currentTarget,a=M.indexOf(t),n=v[a].value;n!==O&&(T(t),P(n),null!=k&&S(k,n))},E=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n=M.indexOf(e.currentTarget)+1;a=M[n]||M[0];break;case"ArrowLeft":var r=M.indexOf(e.currentTarget)-1;a=M[r]||M[M.length-1]}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,p.Z)("tabs-container",d)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,p.Z)("tabs",{"tabs--block":f},g)},v.map((function(e){var t=e.value,a=e.label,o=e.attributes;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:O===t?0:-1,"aria-selected":O===t,key:t,ref:function(e){return M.push(e)},onKeyDown:E,onFocus:D,onClick:D},o,{className:(0,p.Z)("tabs__item",m,null==o?void 0:o.className,{"tabs__item--active":O===t})}),null!=a?a:t)}))),u?(0,r.cloneElement)(N.filter((function(e){return e.props.value===O}))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},N.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==O})}))))}function f(e){var t=(0,o.Z)();return r.createElement(u,(0,n.Z)({key:String(t)},e))}},89228:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return d},default:function(){return h},frontMatter:function(){return p},metadata:function(){return m},toc:function(){return f}});var n=a(87462),r=a(63366),o=(a(67294),a(3905)),l=a(9877),i=a(72360),s=["components"],p={id:"tiered-storage-filesystem",title:"Use filesystem offloader with Pulsar",sidebar_label:"Filesystem offloader"},d=void 0,m={unversionedId:"tiered-storage-filesystem",id:"tiered-storage-filesystem",title:"Use filesystem offloader with Pulsar",description:"This chapter guides you through every step of installing and configuring the filesystem offloader and using it with Pulsar.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/tiered-storage-filesystem.md",sourceDirName:".",slug:"/tiered-storage-filesystem",permalink:"/fr/docs/next/tiered-storage-filesystem",draft:!1,editUrl:"https://github.com/apache/pulsar/edit/master/site2/docs/tiered-storage-filesystem.md",tags:[],version:"current",frontMatter:{id:"tiered-storage-filesystem",title:"Use filesystem offloader with Pulsar",sidebar_label:"Filesystem offloader"},sidebar:"docsSidebar",previous:{title:"GCS offloader",permalink:"/fr/docs/next/tiered-storage-gcs"},next:{title:"Azure BlobStore offloader",permalink:"/fr/docs/next/tiered-storage-azure"}},u={},f=[{value:"Installation",id:"installation",level:2},{value:"Prerequisite",id:"prerequisite",level:3},{value:"Step",id:"step",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Configure filesystem offloader driver",id:"configure-filesystem-offloader-driver",level:3},{value:"Run filesystem offloader automatically",id:"run-filesystem-offloader-automatically",level:3},{value:"Example",id:"example",level:4},{value:"Run filesystem offloader manually",id:"run-filesystem-offloader-manually",level:3},{value:"Example",id:"example-1",level:4},{value:"Tutorial",id:"tutorial",level:2},{value:"Offload data to HDFS",id:"offload-data-to-hdfs",level:3},{value:"Step 1: Prepare the HDFS environment",id:"step-1-prepare-the-hdfs-environment",level:4},{value:"Step 2: Install the filesystem offloader",id:"step-2-install-the-filesystem-offloader",level:4},{value:"Step 3: Configure the filesystem offloader",id:"step-3-configure-the-filesystem-offloader",level:4},{value:"Step 4: Offload data from BookKeeper to filesystem",id:"step-4-offload-data-from-bookkeeper-to-filesystem",level:4},{value:"Offload data to NFS",id:"offload-data-to-nfs",level:3},{value:"Step 1: Install the filesystem offloader",id:"step-1-install-the-filesystem-offloader",level:4},{value:"Step 2: Mount your NFS to your local filesystem",id:"step-2-mount-your-nfs-to-your-local-filesystem",level:4},{value:"Step 3: Configure the filesystem offloader driver",id:"step-3-configure-the-filesystem-offloader-driver",level:4},{value:"Step 4: Offload data from BookKeeper to filesystem",id:"step-4-offload-data-from-bookkeeper-to-filesystem-1",level:4},{value:"Read offloaded data from filesystem",id:"read-offloaded-data-from-filesystem",level:2}],c={toc:f};function h(e){var t=e.components,p=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,n.Z)({},c,p,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This chapter guides you through every step of installing and configuring the filesystem offloader and using it with Pulsar."),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)("p",null,"This section describes how to install the filesystem offloader."),(0,o.kt)("h3",{id:"prerequisite"},"Prerequisite"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Pulsar: 2.4.2 or higher versions")),(0,o.kt)("h3",{id:"step"},"Step"),(0,o.kt)("p",null,"This example uses Pulsar 2.5.1."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download the Pulsar tarball using one of the following ways:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Download the Pulsar tarball from the ",(0,o.kt)("a",{parentName:"p",href:"https://archive.apache.org/dist/pulsar/pulsar-2.5.1/apache-pulsar-2.5.1-bin.tar.gz"},"Apache mirror"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Download the Pulsar tarball from the Pulsar ",(0,o.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/download"},"download page"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Use the ",(0,o.kt)("a",{parentName:"p",href:"https://www.gnu.org/software/wget"},"wget")," command to download the Pulsar tarball."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"\nwget https://archive.apache.org/dist/pulsar/pulsar-2.5.1/apache-pulsar-2.5.1-bin.tar.gz\n\n"))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download and untar the Pulsar offloaders package."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\nwget https://downloads.apache.org/pulsar/pulsar-2.5.1/apache-pulsar-offloaders-2.5.1-bin.tar.gz\n\ntar xvfz apache-pulsar-offloaders-2.5.1-bin.tar.gz\n\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"If you run Pulsar in a bare-metal cluster, ensure that the ",(0,o.kt)("inlineCode",{parentName:"li"},"offloaders")," tarball is unzipped in every broker's Pulsar directory."),(0,o.kt)("li",{parentName:"ul"},"If you run Pulsar in Docker or deploying Pulsar using a Docker image (such as K8S and DCOS), you can use the ",(0,o.kt)("inlineCode",{parentName:"li"},"apachepulsar/pulsar-all")," image. The ",(0,o.kt)("inlineCode",{parentName:"li"},"apachepulsar/pulsar-all")," image has already bundled tiered storage offloaders."))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the Pulsar offloaders as ",(0,o.kt)("inlineCode",{parentName:"p"},"offloaders")," in the Pulsar directory."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nmv apache-pulsar-offloaders-2.5.1/offloaders apache-pulsar-2.5.1/offloaders\n\nls offloaders\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\ntiered-storage-file-system-2.5.1.nar\ntiered-storage-jcloud-2.5.1.nar\n\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"If you run Pulsar in a bare-metal cluster, ensure that ",(0,o.kt)("inlineCode",{parentName:"li"},"offloaders")," tarball is unzipped in every broker's Pulsar directory."),(0,o.kt)("li",{parentName:"ul"},"If you run Pulsar in Docker or deploying Pulsar using a Docker image (such as K8s and DCOS), you can use the ",(0,o.kt)("inlineCode",{parentName:"li"},"apachepulsar/pulsar-all")," image. The ",(0,o.kt)("inlineCode",{parentName:"li"},"apachepulsar/pulsar-all")," image has already bundled tiered storage offloaders.")))))),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Before offloading data from BookKeeper to filesystem, you need to configure some properties of the filesystem offloader driver."))),(0,o.kt)("p",null,"Besides, you can also configure the filesystem offloader to run it automatically or trigger it manually."),(0,o.kt)("h3",{id:"configure-filesystem-offloader-driver"},"Configure filesystem offloader driver"),(0,o.kt)("p",null,"You can configure the filesystem offloader driver in the ",(0,o.kt)("inlineCode",{parentName:"p"},"broker.conf")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"standalone.conf")," configuration file."),(0,o.kt)(l.Z,{defaultValue:"HDFS",values:[{label:"HDFS",value:"HDFS"},{label:"NFS",value:"NFS"}],mdxType:"Tabs"},(0,o.kt)(i.Z,{value:"HDFS",mdxType:"TabItem"},(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Required")," configurations are as below."),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Example value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"managedLedgerOffloadDriver")),(0,o.kt)("td",{parentName:"tr",align:null},"Offloader driver name, which is case-insensitive."),(0,o.kt)("td",{parentName:"tr",align:null},"filesystem")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"fileSystemURI")),(0,o.kt)("td",{parentName:"tr",align:null},"Connection address, which is the URI to access the default Hadoop distributed file system."),(0,o.kt)("td",{parentName:"tr",align:null},"hdfs://127.0.0.1:9000")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"offloadersDirectory")),(0,o.kt)("td",{parentName:"tr",align:null},"Offloader directory"),(0,o.kt)("td",{parentName:"tr",align:null},"offloaders")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"fileSystemProfilePath")),(0,o.kt)("td",{parentName:"tr",align:null},"Hadoop profile path. The configuration file is stored in the Hadoop profile path. It contains various settings for Hadoop performance tuning."),(0,o.kt)("td",{parentName:"tr",align:null},"../conf/filesystem_offload_core_site.xml")))))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Optional")," configurations are as below."),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Example value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"managedLedgerMinLedgerRolloverTimeMinutes")),(0,o.kt)("td",{parentName:"tr",align:null},"Minimum time between ledger rollover for a topic. ",(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("strong",{parentName:"td"},"Note"),": it is not recommended to set this parameter in the production environment."),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"managedLedgerMaxEntriesPerLedger")),(0,o.kt)("td",{parentName:"tr",align:null},"Maximum number of entries to append to a ledger before triggering a rollover.",(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("strong",{parentName:"td"},"Note"),": it is not recommended to set this parameter in the production environment."),(0,o.kt)("td",{parentName:"tr",align:null},"5000"))))))),(0,o.kt)(i.Z,{value:"NFS",mdxType:"TabItem"},(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Required")," configurations are as below.\nParameter | Description | Example value\n|---|---|---\n",(0,o.kt)("inlineCode",{parentName:"p"},"managedLedgerOffloadDriver")," | Offloader driver name, which is case-insensitive. | filesystem\n",(0,o.kt)("inlineCode",{parentName:"p"},"offloadersDirectory")," | Offloader directory | offloaders\n",(0,o.kt)("inlineCode",{parentName:"p"},"fileSystemProfilePath")," | NFS profile path. The configuration file is stored in the NFS profile path. It contains various settings for performance tuning. | ../conf/filesystem_offload_core_site.xml")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Optional")," configurations are as below."),(0,o.kt)("table",{parentName:"li"},(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Example value"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"managedLedgerMinLedgerRolloverTimeMinutes")),(0,o.kt)("td",{parentName:"tr",align:null},"Minimum time between ledger rollover for a topic. ",(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("strong",{parentName:"td"},"Note"),": it is not recommended to set this parameter in the production environment."),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"managedLedgerMaxEntriesPerLedger")),(0,o.kt)("td",{parentName:"tr",align:null},"Maximum number of entries to append to a ledger before triggering a rollover.",(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("strong",{parentName:"td"},"Note"),": it is not recommended to set this parameter in the production environment."),(0,o.kt)("td",{parentName:"tr",align:null},"5000")))))))),(0,o.kt)("h3",{id:"run-filesystem-offloader-automatically"},"Run filesystem offloader automatically"),(0,o.kt)("p",null,"You can configure the namespace policy to offload data automatically once a threshold is reached. The threshold is based on the size of data that a topic has stored on a Pulsar cluster. Once the topic storage reaches the threshold, an offload operation is triggered automatically."),(0,o.kt)("p",null,"Threshold value|Action |---|--- | > 0 | It triggers the offloading operation if the topic storage reaches its threshold. = 0|It causes a broker to offload data as soon as possible. < 0 |It disables automatic offloading operation."),(0,o.kt)("p",null,"Automatic offload runs when a new segment is added to a topic log. If you set the threshold on a namespace, but few messages are being produced to the topic, the filesystem offloader does not work until the current segment is full."),(0,o.kt)("p",null,"You can configure the threshold using CLI tools, such as pulsar-admin."),(0,o.kt)("h4",{id:"example"},"Example"),(0,o.kt)("p",null,"This example sets the filesystem offloader threshold to 10 MB using pulsar-admin."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\npulsar-admin namespaces set-offload-threshold --size 10M my-tenant/my-namespace\n\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For more information about the ",(0,o.kt)("inlineCode",{parentName:"p"},"pulsar-admin namespaces set-offload-threshold options")," command, including flags, descriptions, default values, and shorthands, see ",(0,o.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/tools/pulsar-admin/"},"here"),"."))),(0,o.kt)("h3",{id:"run-filesystem-offloader-manually"},"Run filesystem offloader manually"),(0,o.kt)("p",null,"For individual topics, you can trigger the filesystem offloader manually using one of the following methods:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Use the REST endpoint.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Use CLI tools (such as pulsar-admin)."))),(0,o.kt)("p",null,"To manually trigger the filesystem offloader via CLI tools, you need to specify the maximum amount of data (threshold) that should be retained on a Pulsar cluster for a topic. If the size of the topic data on the Pulsar cluster exceeds this threshold, segments from the topic are offloaded to the filesystem until the threshold is no longer exceeded. Older segments are offloaded first."),(0,o.kt)("h4",{id:"example-1"},"Example"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This example manually runs the filesystem offloader using pulsar-admin."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\npulsar-admin topics offload --size-threshold 10M persistent://my-tenant/my-namespace/topic1\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\nOffload triggered for persistent://my-tenant/my-namespace/topic1 for messages before 2:0:-1\n\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For more information about the ",(0,o.kt)("inlineCode",{parentName:"p"},"pulsar-admin topics offload options")," command, including flags, descriptions, default values, and shorthands, see ",(0,o.kt)("a",{parentName:"p",href:"/fr/docs/next/reference-pulsar-admin#offload"},"here"),".")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This example checks filesystem offloader status using pulsar-admin."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\npulsar-admin topics offload-status persistent://my-tenant/my-namespace/topic1\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\nOffload is currently running\n\n")),(0,o.kt)("p",{parentName:"li"},"To wait for the filesystem to complete the job, add the ",(0,o.kt)("inlineCode",{parentName:"p"},"-w")," flag."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\npulsar-admin topics offload-status -w persistent://my-tenant/my-namespace/topic1\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nOffload was a success\n\n")),(0,o.kt)("p",{parentName:"li"},"If there is an error in the offloading operation, the error is propagated to the ",(0,o.kt)("inlineCode",{parentName:"p"},"pulsar-admin topics offload-status")," command."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"\npulsar-admin topics offload-status persistent://my-tenant/my-namespace/topic1\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nError in offload\nnull\n\nReason: Error offloading: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: com.amazonaws.services.s3.model.AmazonS3Exception: Anonymous users cannot initiate multipart uploads.  Please authenticate. (Service: Amazon S3; Status Code: 403; Error Code: AccessDenied; Request ID: 798758DE3F1776DF; S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g=), S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g=\n\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For more information about the ",(0,o.kt)("inlineCode",{parentName:"p"},"pulsar-admin topics offload-status options")," command, including flags, descriptions, default values, and shorthands, see ",(0,o.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/tools/pulsar-admin/"},"here"),"."))))),(0,o.kt)("h2",{id:"tutorial"},"Tutorial"),(0,o.kt)("p",null,"This section provides step-by-step instructions on how to use the filesystem offloader to move data from Pulsar to Hadoop Distributed File System (HDFS) or Network File system (NFS)."),(0,o.kt)("h3",{id:"offload-data-to-hdfs"},"Offload data to HDFS"),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This tutorial sets up a Hadoop single node cluster and uses Hadoop 3.2.1. For details about how to set up a Hadoop single node cluster, see ",(0,o.kt)("a",{parentName:"p",href:"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html"},"here"),"."))),(0,o.kt)("h4",{id:"step-1-prepare-the-hdfs-environment"},"Step 1: Prepare the HDFS environment"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Download and uncompress Hadoop 3.2.1."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nwget https://mirrors.bfsu.edu.cn/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz  \n\ntar -zxvf hadoop-3.2.1.tar.gz -C $HADOOP_HOME\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Configure Hadoop."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\n# $HADOOP_HOME/etc/hadoop/core-site.xml\n<configuration>\n    <property>\n        <name>fs.defaultFS</name>\n        <value>hdfs://localhost:9000</value>\n    </property>\n</configuration>\n\n# $HADOOP_HOME/etc/hadoop/hdfs-site.xml\n<configuration>\n    <property>\n        <name>dfs.replication</name>\n        <value>1</value>\n    </property>\n</configuration>\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set passphraseless ssh."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\n# Now check that you can ssh to the localhost without a passphrase:\n$ ssh localhost\n# If you cannot ssh to localhost without a passphrase, execute the following commands\n$ ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa\n$ cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\n$ chmod 0600 ~/.ssh/authorized_keys\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start HDFS."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\n# don't execute this command repeatedly, repeat execute will cauld the clusterId of the datanode is not consistent with namenode\n$HADOOP_HOME/bin/hadoop namenode -format\n$HADOOP_HOME/sbin/start-dfs.sh\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Navigate to the ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:9870/"},"HDFS website"),"."),(0,o.kt)("p",{parentName:"li"},"You can see the ",(0,o.kt)("strong",{parentName:"p"},"Overview")," page."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{src:a(59407).Z,width:"2396",height:"1668"})),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"At the top navigation bar, click ",(0,o.kt)("strong",{parentName:"p"},"Datanodes")," to check DataNode information."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{src:a(40314).Z,width:"2452",height:"1638"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click ",(0,o.kt)("strong",{parentName:"p"},"HTTP Address")," to get more detailed information about localhost:9866."),(0,o.kt)("p",{parentName:"li"},"As can be seen below, the size of ",(0,o.kt)("strong",{parentName:"p"},"Capacity Used")," is 4 KB, which is the initial value."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{src:a(15321).Z,width:"2392",height:"1504"})))))),(0,o.kt)("h4",{id:"step-2-install-the-filesystem-offloader"},"Step 2: Install the filesystem offloader"),(0,o.kt)("p",null,"For details, see ",(0,o.kt)("a",{parentName:"p",href:"#installation"},"installation"),"."),(0,o.kt)("h4",{id:"step-3-configure-the-filesystem-offloader"},"Step 3: Configure the filesystem offloader"),(0,o.kt)("p",null,"As indicated in the ",(0,o.kt)("a",{parentName:"p",href:"#configuration"},"configuration")," section, you need to configure some properties for the filesystem offloader driver before using it. This tutorial assumes that you have configured the filesystem offloader driver as below and run Pulsar in ",(0,o.kt)("strong",{parentName:"p"},"standalone")," mode."),(0,o.kt)("p",null,"Set the following configurations in the ",(0,o.kt)("inlineCode",{parentName:"p"},"conf/standalone.conf")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"\nmanagedLedgerOffloadDriver=filesystem\nfileSystemURI=hdfs://127.0.0.1:9000\nfileSystemProfilePath=../conf/filesystem_offload_core_site.xml\n\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For testing purposes, you can set the following two configurations to speed up ledger rollover, but it is not recommended that you set them in the production environment."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\nmanagedLedgerMinLedgerRolloverTimeMinutes=1\nmanagedLedgerMaxEntriesPerLedger=100\n\n")),(0,o.kt)("h4",{id:"step-4-offload-data-from-bookkeeper-to-filesystem"},"Step 4: Offload data from BookKeeper to filesystem"),(0,o.kt)("p",null,"Execute the following commands in the repository where you download Pulsar tarball. For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"~/path/to/apache-pulsar-2.5.1"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Start Pulsar standalone."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar standalone -a 127.0.0.1\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To ensure the data generated is not deleted immediately, it is recommended to set the ",(0,o.kt)("a",{parentName:"p",href:"/fr/docs/next/cookbooks-retention-expiry/#retention-policies"},"retention policy"),", which can be either a ",(0,o.kt)("strong",{parentName:"p"},"size")," limit or a ",(0,o.kt)("strong",{parentName:"p"},"time")," limit. The larger value you set for the retention policy, the longer the data can be retained."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar-admin namespaces set-retention public/default --size 100M --time 2d\n\n")),(0,o.kt)("div",{parentName:"li",className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For more information about the ",(0,o.kt)("inlineCode",{parentName:"p"},"pulsarctl namespaces set-retention options")," command, including flags, descriptions, default values, and shorthands, see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.streamnative.io/pulsarctl/v2.7.0.6/#-em-set-retention-em-"},"here"),".")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Produce data using pulsar-client."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'\nbin/pulsar-client produce -m "Hello FileSystem Offloader" -n 1000 public/default/fs-test\n\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The offloading operation starts after a ledger rollover is triggered. To ensure offload data successfully, it is recommended that you wait until several ledger rollovers are triggered. In this case, you might need to wait for a second. You can check the ledger status using pulsarctl."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar-admin topics stats-internal public/default/fs-test\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("p",{parentName:"li"},"The data of the ledger 696 is not offloaded."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'\n{\n"version": 1,\n"creationDate": "2020-06-16T21:46:25.807+08:00",\n"modificationDate": "2020-06-16T21:46:25.821+08:00",\n"ledgers": [\n{\n    "ledgerId": 696,\n    "isOffloaded": false\n}\n],\n"cursors": {}\n}\n\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Wait for a second and send more messages to the topic."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'\nbin/pulsar-client produce -m "Hello FileSystem Offloader" -n 1000 public/default/fs-test\n\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Check the ledger status using pulsarctl."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar-admin topics stats-internal public/default/fs-test\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("p",{parentName:"li"},"The ledger 696 is rollovered."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'\n{\n"version": 2,\n"creationDate": "2020-06-16T21:46:25.807+08:00",\n"modificationDate": "2020-06-16T21:48:52.288+08:00",\n"ledgers": [\n{\n    "ledgerId": 696,\n    "entries": 1001,\n    "size": 81695,\n    "isOffloaded": false\n},\n{\n    "ledgerId": 697,\n    "isOffloaded": false\n}\n],\n"cursors": {}\n}\n\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Trigger the offloading operation manually using pulsarctl."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar-admin topics offload -s 0 public/default/fs-test\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("p",{parentName:"li"},"Data in ledgers before the ledge 697 is offloaded."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\n# offload info, the ledgers before 697 will be offloaded\nOffload triggered for persistent://public/default/fs-test3 for messages before 697:0:-1\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Check the ledger status using pulsarctl."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\nbin/pulsar-admin topics stats-internal public/default/fs-test\n\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("p",{parentName:"li"},"The data of the ledger 696 is offloaded."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'\n{\n"version": 4,\n"creationDate": "2020-06-16T21:46:25.807+08:00",\n"modificationDate": "2020-06-16T21:52:13.25+08:00",\n"ledgers": [\n{\n    "ledgerId": 696,\n    "entries": 1001,\n    "size": 81695,\n    "isOffloaded": true\n},\n{\n    "ledgerId": 697,\n    "isOffloaded": false\n}\n],\n"cursors": {}\n}\n\n')),(0,o.kt)("p",{parentName:"li"},"And the ",(0,o.kt)("strong",{parentName:"p"},"Capacity Used")," is changed from 4 KB to 116.46 KB."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{src:a(55485).Z,width:"2422",height:"1498"})))),(0,o.kt)("h3",{id:"offload-data-to-nfs"},"Offload data to NFS"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"In this section, it is assumed that you have enabled NFS service and set the shared path of your NFS service. In this section, ",(0,o.kt)("inlineCode",{parentName:"p"},"/Users/test")," is used as the shared path of NFS service."))),(0,o.kt)("h4",{id:"step-1-install-the-filesystem-offloader"},"Step 1: Install the filesystem offloader"),(0,o.kt)("p",null,"For details, see ",(0,o.kt)("a",{parentName:"p",href:"#installation"},"installation"),"."),(0,o.kt)("h4",{id:"step-2-mount-your-nfs-to-your-local-filesystem"},"Step 2: Mount your NFS to your local filesystem"),(0,o.kt)("p",null,"This example mounts ",(0,o.kt)("em",{parentName:"p"},"/Users/pulsar_nfs")," to ",(0,o.kt)("em",{parentName:"p"},"/Users/test"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\nmount -e 192.168.0.103:/Users/test/Users/pulsar_nfs\n\n")),(0,o.kt)("h4",{id:"step-3-configure-the-filesystem-offloader-driver"},"Step 3: Configure the filesystem offloader driver"),(0,o.kt)("p",null,"As indicated in the ",(0,o.kt)("a",{parentName:"p",href:"#configuration"},"configuration")," section, you need to configure some properties for the filesystem offloader driver before using it. This tutorial assumes that you have configured the filesystem offloader driver as below and run Pulsar in ",(0,o.kt)("strong",{parentName:"p"},"standalone")," mode."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set the following configurations in the ",(0,o.kt)("inlineCode",{parentName:"p"},"conf/standalone.conf")," file."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-conf"},"\nmanagedLedgerOffloadDriver=filesystem\nfileSystemProfilePath=../conf/filesystem_offload_core_site.xml\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Modify the ",(0,o.kt)("em",{parentName:"p"},"filesystem_offload_core_site.xml")," as follows."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"\n<property>\n    <name>fs.defaultFS</name>\n    <value>file:///</value>\n</property>\n\n<property>\n    <name>hadoop.tmp.dir</name>\n    <value>file:///Users/pulsar_nfs</value>\n</property>\n\n<property>\n    <name>io.file.buffer.size</name>\n    <value>4096</value>\n</property>\n\n<property>\n    <name>io.seqfile.compress.blocksize</name>\n    <value>1000000</value>\n</property>\n<property>\n\n    <name>io.seqfile.compression.type</name>\n    <value>BLOCK</value>\n</property>\n\n<property>\n    <name>io.map.index.interval</name>\n    <value>128</value>\n</property>\n\n")))),(0,o.kt)("h4",{id:"step-4-offload-data-from-bookkeeper-to-filesystem-1"},"Step 4: Offload data from BookKeeper to filesystem"),(0,o.kt)("p",null,"Refer to the step 4 of ",(0,o.kt)("a",{parentName:"p",href:"#step-4-offload-data-from-bookkeeper-to-filesystem"},"Offload data to HDFS"),"."),(0,o.kt)("h2",{id:"read-offloaded-data-from-filesystem"},"Read offloaded data from filesystem"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The offloaded data is stored as ",(0,o.kt)("inlineCode",{parentName:"p"},"MapFile")," in the following new path of the filesystem:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-properties"},'\npath = storageBasePath + "/" + managedLedgerName + "/" + ledgerId + "-" + uuid.toString();\n\n')),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"storageBasePath")," is the value of ",(0,o.kt)("inlineCode",{parentName:"li"},"hadoop.tmp.dir"),", which is configured in ",(0,o.kt)("inlineCode",{parentName:"li"},"broker.conf")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"filesystem_offload_core_site.xml"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"managedLedgerName")," is the ledger name of the persistentTopic manager.")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"\n managedLedgerName of persistent://public/default/topics-name is public/default/persistent/topics-name.\n\n")),(0,o.kt)("p",{parentName:"li"},"You can use the following method to get ",(0,o.kt)("inlineCode",{parentName:"p"},"managedLedgerName"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'\n String managedLedgerName = TopicName.get("persistent://public/default/topics-name").getPersistenceNamingEncoding();\n\n')))),(0,o.kt)("p",null,"To read data out as ledger entries from the filesystem, complete the following steps."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a reader to read both ",(0,o.kt)("inlineCode",{parentName:"p"},"MapFile")," with a new path and the ",(0,o.kt)("inlineCode",{parentName:"p"},"configuration")," of the filesystem."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"\n  MapFile.Reader reader = new MapFile.Reader(new Path(dataFilePath),  configuration);\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Read the data as ",(0,o.kt)("inlineCode",{parentName:"p"},"LedgerEntry")," from the filesystem."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\n  LongWritable key = new LongWritable();\n  BytesWritable value = new BytesWritable();\n  key.set(nextExpectedId - 1);\n  reader.seek(key);\n  reader.next(key, value);\n  int length = value.getLength();\n  long entryId = key.get();\n  ByteBuf buf = PooledByteBufAllocator.DEFAULT.buffer(length, length);\n  buf.writeBytes(value.copyBytes());\n  LedgerEntryImpl ledgerEntry = LedgerEntryImpl.create(ledgerId, entryId, length, buf);\n\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Deserialize the ",(0,o.kt)("inlineCode",{parentName:"p"},"LedgerEntry")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"Message"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},'\n     ByteBuf metadataAndPayload = ledgerEntry.getDataBuffer();\n     long totalSize = metadataAndPayload.readableBytes();\n     BrokerEntryMetadata brokerEntryMetadata = Commands.peekBrokerEntryMetadataIfExist(metadataAndPayload);\n     MessageMetadata metadata = Commands.parseMessageMetadata(metadataAndPayload);\n\n     Map<String, String> properties = new TreeMap();\n     properties.put("X-Pulsar-batch-size", String.valueOf(totalSize\n             - metadata.getSerializedSize()));\n     properties.put("TOTAL-CHUNKS", Integer.toString(metadata.getNumChunksFromMsg()));\n     properties.put("CHUNK-ID", Integer.toString(metadata.getChunkId()));\n\n     // Decode if needed\n     CompressionCodec codec = CompressionCodecProvider.getCompressionCodec(metadata.getCompression());\n     ByteBuf uncompressedPayload = codec.decode(metadataAndPayload, metadata.getUncompressedSize());\n     // Copy into a heap buffer for output stream compatibility\n     ByteBuf data = PulsarByteBufAllocator.DEFAULT.heapBuffer(uncompressedPayload.readableBytes(),\n             uncompressedPayload.readableBytes());\n     data.writeBytes(uncompressedPayload);\n     uncompressedPayload.release();\n\n     MessageImpl message = new MessageImpl(topic, ((PositionImpl)ledgerEntry.getPosition()).toString(), properties,\n             data, Schema.BYTES, metadata);\n     message.setBrokerEntryMetadata(brokerEntryMetadata);\n\n')))))}h.isMDXComponent=!0},59407:function(e,t,a){t.Z=a.p+"assets/images/FileSystem-1-8fba41a03bedc3e2d89a0fccf0b80f0f.png"},40314:function(e,t,a){t.Z=a.p+"assets/images/FileSystem-2-e35ac7fd0ad15579667dde0f831eaa02.png"},15321:function(e,t,a){t.Z=a.p+"assets/images/FileSystem-3-0c94a33a238a8753b06d8e9e99fc31fc.png"},55485:function(e,t,a){t.Z=a.p+"assets/images/FileSystem-8-679ffa9ebb34e9242170e98af24d67d6.png"}}]);