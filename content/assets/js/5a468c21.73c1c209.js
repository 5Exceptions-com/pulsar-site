"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[83202],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(n),m=r,d=h["".concat(s,".").concat(m)]||h[m]||u[m]||o;return n?a.createElement(d,i(i({ref:t},p),{},{components:n})):a.createElement(d,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(86010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,i),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),r=n(67294),o=n(86010),i=n(72389),l=n(67392),s=n(7094),c=n(12466);const p="tabList__CuJ",u="tabItem_LNqP";function h(e){var t;const{lazy:n,block:i,defaultValue:h,values:m,groupId:d,className:k}=e,f=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),y=m??f.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,l.l)(y,((e,t)=>e.value===t.value));if(g.length>0)throw new Error(`Docusaurus error: Duplicate values "${g.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===h?h:h??(null==(t=f.find((e=>e.props.default)))?void 0:t.props.value)??f[0].props.value;if(null!==b&&!y.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${y.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:C}=(0,s.U)(),[N,T]=(0,r.useState)(b),S=[],{blockElementScrollPositionUntilNextRender:w}=(0,c.o5)();if(null!=d){const e=v[d];null!=e&&e!==N&&y.some((t=>t.value===e))&&T(e)}const P=e=>{const t=e.currentTarget,n=S.indexOf(t),a=y[n].value;a!==N&&(w(t),T(a),null!=d&&C(d,String(a)))},x=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=S.indexOf(e.currentTarget)+1;n=S[t]??S[0];break}case"ArrowLeft":{const t=S.indexOf(e.currentTarget)-1;n=S[t]??S[S.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,o.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":i},k)},y.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:N===t?0:-1,"aria-selected":N===t,key:t,ref:e=>S.push(e),onKeyDown:x,onFocus:P,onClick:P},i,{className:(0,o.Z)("tabs__item",u,null==i?void 0:i.className,{"tabs__item--active":N===t})}),n??t)}))),n?(0,r.cloneElement)(f.filter((e=>e.props.value===N))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==N})))))}function m(e){const t=(0,i.Z)();return r.createElement(h,(0,a.Z)({key:String(t)},e))}},49358:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var a=n(87462),r=(n(67294),n(3905)),o=n(65488),i=n(85162);const l={id:"security-tls-transport",title:"Transport Encryption using TLS",sidebar_label:"Transport Encryption using TLS"},s=void 0,c={unversionedId:"security-tls-transport",id:"security-tls-transport",title:"Transport Encryption using TLS",description:"TLS overview",source:"@site/docs/security-tls-transport.md",sourceDirName:".",slug:"/security-tls-transport",permalink:"/docs/next/security-tls-transport",draft:!1,editUrl:"https://github.com/apache/pulsar/edit/master/site2/docs/security-tls-transport.md",tags:[],version:"current",frontMatter:{id:"security-tls-transport",title:"Transport Encryption using TLS",sidebar_label:"Transport Encryption using TLS"},sidebar:"docsSidebar",previous:{title:"End-to-End Encryption",permalink:"/docs/next/security-encryption"},next:{title:"Bouncy Castle Providers",permalink:"/docs/next/security-bouncy-castle"}},p={},u=[{value:"TLS overview",id:"tls-overview",level:2},{value:"TLS concepts",id:"tls-concepts",level:2},{value:"Create TLS certificates",id:"create-tls-certificates",level:2},{value:"Certificate authority",id:"certificate-authority",level:3},{value:"Server certificate",id:"server-certificate",level:3},{value:"Client certificate",id:"client-certificate",level:3},{value:"Configure brokers",id:"configure-brokers",level:2},{value:"TLS Protocol Version and Cipher",id:"tls-protocol-version-and-cipher",level:3},{value:"Configure proxies",id:"configure-proxies",level:2},{value:"Configure clients",id:"configure-clients",level:2},{value:"Hostname verification",id:"hostname-verification",level:3},{value:"Configure TLS encryption in CLI tools",id:"configure-tls-encryption-in-cli-tools",level:2},{value:"Configure TLS encryption with KeyStore",id:"configure-tls-encryption-with-keystore",level:2},{value:"Generate TLS key and certificate",id:"generate-tls-key-and-certificate",level:3},{value:"Create your own CA",id:"create-your-own-ca",level:3},{value:"Sign the certificate",id:"sign-the-certificate",level:3},{value:"Configure brokers",id:"configure-brokers-1",level:3},{value:"Configure Clients",id:"configure-clients-1",level:3},{value:"Enable TLS Logging",id:"enable-tls-logging",level:2}],h={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"tls-overview"},"TLS overview"),(0,r.kt)("p",null,"By default, Apache Pulsar clients communicate with the Apache Pulsar service in plain text. This means that all data is sent in the clear. You can use TLS to encrypt this traffic to protect the traffic from the snooping of a man-in-the-middle attacker."),(0,r.kt)("p",null,"You can also configure TLS for both encryption and authentication. Use this guide to configure just TLS transport encryption and refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-tls-authentication"},"here")," for TLS authentication configuration. Alternatively, you can use ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-athenz"},"another authentication mechanism")," on top of TLS transport encryption."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that enabling TLS may impact the performance due to encryption overhead.")),(0,r.kt)("h2",{id:"tls-concepts"},"TLS concepts"),(0,r.kt)("p",null,"TLS is a form of ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Public-key_cryptography"},"public key cryptography"),". Using key pairs consisting of a public key and a private key can perform the encryption. The public key encrypts the messages and the private key decrypts the messages."),(0,r.kt)("p",null,"To use TLS transport encryption, you need two kinds of key pairs, ",(0,r.kt)("strong",{parentName:"p"},"server key pairs")," and a ",(0,r.kt)("strong",{parentName:"p"},"certificate authority"),"."),(0,r.kt)("p",null,"You can use a third kind of key pair, ",(0,r.kt)("strong",{parentName:"p"},"client key pairs"),", for ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-tls-authentication"},"client authentication"),"."),(0,r.kt)("p",null,"You should store the ",(0,r.kt)("strong",{parentName:"p"},"certificate authority")," private key in a very secure location (a fully encrypted, disconnected, air gapped computer). As for the certificate authority public key, the ",(0,r.kt)("strong",{parentName:"p"},"trust cert"),", you can freely share it."),(0,r.kt)("p",null,"For both client and server key pairs, the administrator first generates a private key and a certificate request, then uses the certificate authority private key to sign the certificate request, and finally generates a certificate. This certificate is the public key for the server/client key pair."),(0,r.kt)("p",null,"For TLS transport encryption, the clients can use the ",(0,r.kt)("strong",{parentName:"p"},"trust cert")," to verify that the server has a key pair that the certificate authority signs when the clients are talking to the server. A man-in-the-middle attacker does not have access to the certificate authority, so they couldn't create a server with such a key pair."),(0,r.kt)("p",null,"For TLS authentication, the server uses the ",(0,r.kt)("strong",{parentName:"p"},"trust cert")," to verify that the client has a key pair that the certificate authority signed. The common name of the ",(0,r.kt)("strong",{parentName:"p"},"client cert")," is then used as the client's role token (see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-overview"},"Overview"),")."),(0,r.kt)("p",null,"Pulsar uses ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/netty/netty-tcnative"},"netty-tcnative")," and ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/google/conscrypt"},"Conscrypt")," as security providers. There are two certificate formats:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Java KeyStore(JKS): Pulsar uses Conscrypt by default for both broker service and Web service."),(0,r.kt)("li",{parentName:"ul"},"CAcerts: Pulsar uses netty-tcnative by default, which includes two implementations, OpenSSL (default) and JDK. When OpenSSL is unavailable, JDK is used.")),(0,r.kt)("h2",{id:"create-tls-certificates"},"Create TLS certificates"),(0,r.kt)("p",null,"Creating TLS certificates for Pulsar involves creating a ",(0,r.kt)("a",{parentName:"p",href:"#certificate-authority"},"certificate authority")," (CA), ",(0,r.kt)("a",{parentName:"p",href:"#server-certificate"},"server certificate"),", and ",(0,r.kt)("a",{parentName:"p",href:"#client-certificate"},"client certificate"),"."),(0,r.kt)("p",null,"Follow the guide below to set up a certificate authority. You can also refer to plenty of resources on the internet for more details. We recommend ",(0,r.kt)("a",{parentName:"p",href:"https://jamielinux.com/docs/openssl-certificate-authority/index.html"},"this guide")," for your detailed reference."),(0,r.kt)("h3",{id:"certificate-authority"},"Certificate authority"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create the certificate for the CA. You can use CA to sign both the broker and client certificates. This ensures that each party will trust the others. You should store CA in a very secure location (ideally completely disconnected from networks, air gapped, and fully encrypted).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Entering the following command to create a directory for your CA, and place ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/tree/master/site2/website/static/examples/openssl.cnf"},"this openssl configuration file")," in the directory. You may want to modify the default answers for company name and department in the configuration file. Export the location of the CA directory to the environment variable, CA_HOME. The configuration file uses this environment variable to find the rest of the files and directories that the CA needs."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir my-ca\ncd my-ca\nwget https://raw.githubusercontent.com/apache/pulsar-site/main/site2/website/static/examples/openssl.cnf\nexport CA_HOME=$(pwd)\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Enter the commands below to create the necessary directories, keys and certs.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir certs crl newcerts private\nchmod 700 private/\ntouch index.txt\necho 1000 > serial\nopenssl genrsa -aes256 -out private/ca.key.pem 4096\n# You need enter a password in the command above\nchmod 400 private/ca.key.pem\nopenssl req -config openssl.cnf -key private/ca.key.pem \\\n    -new -x509 -days 7300 -sha256 -extensions v3_ca \\\n    -out certs/ca.cert.pem\n# You must enter the same password in the previous openssl command\nchmod 444 certs/ca.cert.pem\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The default ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl")," on macOS doesn't work for the commands above. You must upgrade the ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl")," via Homebrew:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'brew install openssl\nexport PATH="/usr/local/Cellar/openssl@3/3.0.1/bin:$PATH"\n')),(0,r.kt)("p",{parentName:"admonition"},"The version ",(0,r.kt)("inlineCode",{parentName:"p"},"3.0.1")," might change in the future. Use the actual path from the output of ",(0,r.kt)("inlineCode",{parentName:"p"},"brew install")," command.")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"After you answer the question prompts, CA-related files are stored in the ",(0,r.kt)("inlineCode",{parentName:"li"},"./my-ca")," directory. Within that directory:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"certs/ca.cert.pem")," is the public certificate. This public certificate is meant to be distributed to all parties involved."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"private/ca.key.pem")," is the private key. You only need it when you are signing a new certificate for either broker or clients and you must safely guard this private key.")),(0,r.kt)("h3",{id:"server-certificate"},"Server certificate"),(0,r.kt)("p",null,"Once you have created a CA certificate, you can create certificate requests and sign them with the CA."),(0,r.kt)("p",null,"The following commands ask you a few questions and then create the certificates. When you are asked for the common name, you should match the hostname of the broker. You can also use a wildcard to match a group of broker hostnames, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"*.broker.usw.example.com"),". This ensures that multiple machines can reuse the same certificate."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Sometimes matching the hostname is not possible or makes no sense,\nsuch as when you create the brokers with random hostnames, or you\nplan to connect to the hosts via their IP. In these cases, you\nshould configure the client to disable TLS hostname verification. For more\ndetails, you can see ",(0,r.kt)("a",{parentName:"p",href:"#hostname-verification"},"the host verification section in client configuration"),".")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Enter the command below to generate the key.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl genrsa -out broker.key.pem 2048\n")),(0,r.kt)("p",null,"The broker expects the key to be in ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/PKCS_8"},"PKCS 8")," format, so enter the following command to convert it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl pkcs8 -topk8 -inform PEM -outform PEM \\\n      -in broker.key.pem -out broker.key-pk8.pem -nocrypt\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Enter the following command to generate the certificate request.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl req -config openssl.cnf \\\n    -key broker.key.pem -new -sha256 -out broker.csr.pem\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Sign it with the certificate authority by entering the command below.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca -config openssl.cnf -extensions server_cert \\\n    -days 1000 -notext -md sha256 \\\n    -in broker.csr.pem -out broker.cert.pem\n")),(0,r.kt)("p",null,"At this point, you have a cert, ",(0,r.kt)("inlineCode",{parentName:"p"},"broker.cert.pem"),", and a key, ",(0,r.kt)("inlineCode",{parentName:"p"},"broker.key-pk8.pem"),", which you can use along with ",(0,r.kt)("inlineCode",{parentName:"p"},"ca.cert.pem")," to configure TLS transport encryption for your broker and proxy nodes."),(0,r.kt)("h3",{id:"client-certificate"},"Client certificate"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Enter the command below to generate the key.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl genrsa -out client.key.pem 2048\n")),(0,r.kt)("p",null,"The client expects the key to be in ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/PKCS_8"},"PKCS 8")," format, so enter the following command to convert it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl pkcs8 -topk8 -inform PEM -outform PEM \\\n      -in client.key.pem -out client.key-pk8.pem -nocrypt\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Enter the following command to generate the certificate request.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl req -config openssl.cnf \\\n    -key client.key.pem -new -sha256 -out client.csr.pem\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Sign it with the certificate authority by entering the command below.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl ca -config openssl.cnf -extensions client_cert \\\n    -days 1000 -notext -md sha256 \\\n    -in client.csr.pem -out client.cert.pem\n")),(0,r.kt)("p",null,"At this point, you have a cert ",(0,r.kt)("inlineCode",{parentName:"p"},"client.cert.pem")," and a key ",(0,r.kt)("inlineCode",{parentName:"p"},"client.key-pk8.pem"),", which you can use along with ",(0,r.kt)("inlineCode",{parentName:"p"},"ca.cert.pem")," to configure TLS encryption for your client."),(0,r.kt)("h2",{id:"configure-brokers"},"Configure brokers"),(0,r.kt)("p",null,"To configure a Pulsar ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-terminology#broker"},"broker")," to use TLS transport encryption, you need to make some changes to ",(0,r.kt)("inlineCode",{parentName:"p"},"broker.conf"),", which locates in the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf")," directory of your ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/getting-started-standalone"},"Pulsar installation"),"."),(0,r.kt)("p",null,"Add these values to the configuration file (substituting the appropriate certificate paths where necessary):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"brokerServicePortTls=6651\nwebServicePortTls=8081\ntlsRequireTrustedClientCertOnConnect=true\ntlsCertificateFilePath=/path/to/broker.cert.pem\ntlsKeyFilePath=/path/to/broker.key-pk8.pem\ntlsTrustCertsFilePath=/path/to/ca.cert.pem\n\nbrokerClientTlsEnabled=true\nbrokerClientTrustCertsFilePath=/path/to/ca.cert.pem\nbrokerClientCertificateFilePath=/path/to/client.cert.pem\nbrokerClientKeyFilePath=/path/to/client.key-pk8.pem\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can find a full list of parameters available in the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf/broker.conf")," file,\nas well as the default values for those parameters, in ",(0,r.kt)("a",{parentName:"p",href:"reference-configuration.md#broker"},"Broker Configuration"))),(0,r.kt)("h3",{id:"tls-protocol-version-and-cipher"},"TLS Protocol Version and Cipher"),(0,r.kt)("p",null,"You can configure the broker (and proxy) to require specific TLS protocol versions and ciphers for TLS negiotation. You can use the TLS protocol versions and ciphers to stop clients from requesting downgraded TLS protocol versions or ciphers that may have weaknesses."),(0,r.kt)("p",null,"Both the TLS protocol versions and cipher properties can take multiple values, separated by commas. The possible values for protocol version and ciphers depend on the TLS provider that you are using. Pulsar uses OpenSSL if the OpenSSL is available, but if the OpenSSL is not available, Pulsar defaults back to the JDK implementation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"tlsProtocols=TLSv1.3,TLSv1.2\ntlsCiphers=TLS_DH_RSA_WITH_AES_256_GCM_SHA384,TLS_DH_RSA_WITH_AES_256_CBC_SHA\n")),(0,r.kt)("p",null,"OpenSSL currently supports ",(0,r.kt)("inlineCode",{parentName:"p"},"TLSv1.1"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"TLSv1.2")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"TLSv1.3")," for the protocol version. You can acquire a list of supported cipher from the openssl ciphers command, i.e. ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl ciphers -tls1_3"),"."),(0,r.kt)("p",null,"For JDK 11, you can obtain a list of supported values from the documentation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.oracle.com/en/java/javase/11/security/oracle-providers.html#GUID-7093246A-31A3-4304-AC5F-5FB6400405E2__SUNJSSEPROVIDERPROTOCOLPARAMETERS-BBF75009"},"TLS protocol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.oracle.com/en/java/javase/11/security/oracle-providers.html#GUID-7093246A-31A3-4304-AC5F-5FB6400405E2__SUNJSSE_CIPHER_SUITES"},"Ciphers"))),(0,r.kt)("h2",{id:"configure-proxies"},"Configure proxies"),(0,r.kt)("p",null,"Proxies need to configure TLS in two directions, for clients connecting to the proxy, and for the proxy connecting to brokers."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"servicePortTls=6651\nwebServicePortTls=8081\n\n# For clients connecting to the proxy\ntlsRequireTrustedClientCertOnConnect=true\ntlsCertificateFilePath=/path/to/broker.cert.pem\ntlsKeyFilePath=/path/to/broker.key-pk8.pem\ntlsTrustCertsFilePath=/path/to/ca.cert.pem\n\n# For the proxy to connect to brokers\ntlsEnabledWithBroker=true\nbrokerClientTrustCertsFilePath=/path/to/ca.cert.pem\nbrokerClientCertificateFilePath=/path/to/client.cert.pem\nbrokerClientKeyFilePath=/path/to/client.key-pk8.pem\n")),(0,r.kt)("h2",{id:"configure-clients"},"Configure clients"),(0,r.kt)("p",null,"When you enable the TLS transport encryption, you need to configure the client to use ",(0,r.kt)("inlineCode",{parentName:"p"},"https://")," and port 8443 for the web service URL, and ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar+ssl://")," and port 6651 for the broker service URL."),(0,r.kt)("p",null,"As the server certificate that you generated above does not belong to any of the default trust chains, you also need to either specify the path of the ",(0,r.kt)("strong",{parentName:"p"},"trust cert")," (recommended), or tell the client to allow untrusted server certs."),(0,r.kt)("h3",{id:"hostname-verification"},"Hostname verification"),(0,r.kt)("p",null,'Hostname verification is a TLS security feature whereby a client can refuse to connect to a server if the "CommonName" does not match the hostname to which the hostname is connecting. By default, Pulsar clients disable hostname verification, as it requires that each broker has a DNS record and a unique cert.'),(0,r.kt)("p",null,'Moreover, as the administrator has full control of the certificate authority, a bad actor is unlikely to be able to pull off a man-in-the-middle attack. "allowInsecureConnection" allows the client to connect to servers whose cert has not been signed by an approved CA. The client disables "allowInsecureConnection" by default, and you should always disable "allowInsecureConnection" in production environments. As long as you disable "allowInsecureConnection", a man-in-the-middle attack requires that the attacker has access to the CA.'),(0,r.kt)("p",null,'One scenario where you may want to enable hostname verification is where you have multiple proxy nodes behind a VIP, and the VIP has a DNS record, for example, pulsar.mycompany.com. In this case, you can generate a TLS cert with pulsar.mycompany.com as the "CommonName," and then enable hostname verification on the client.'),(0,r.kt)("p",null,"The examples below show that hostname verification is disabled for Java/Python/C++/Node.js/C# clients by default."),(0,r.kt)(o.Z,{groupId:"lang-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"Python",value:"Python"},{label:"C++",value:"C++"},{label:"Node.js",value:"Node.js"},{label:"C#",value:"C#"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import org.apache.pulsar.client.api.PulsarClient;\n\nPulsarClient client = PulsarClient.builder()\n    .serviceUrl("pulsar+ssl://broker.example.com:6651/")\n    .tlsKeyFilePath("/path/to/client.key-pk8.pem")\n    .tlsCertificateFilePath("/path/to/client.cert.pem")\n    .tlsTrustCertsFilePath("/path/to/ca.cert.pem")\n    .enableTlsHostnameVerification(false) // false by default, in any case\n    .allowTlsInsecureConnection(false) // false by default, in any case\n    .build();\n'))),(0,r.kt)(i.Z,{value:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pulsar import Client\n\nclient = Client("pulsar+ssl://broker.example.com:6651/",\n                tls_hostname_verification=False,\n                tls_trust_certs_file_path="/path/to/ca.cert.pem",\n                tls_allow_insecure_connection=False) // defaults to false from v2.2.0 onwards\n'))),(0,r.kt)(i.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"#include <pulsar/Client.h>\n\nClientConfiguration config = ClientConfiguration();\nconfig.setUseTls(true);  // shouldn't be needed soon\nconfig.setTlsTrustCertsFilePath(caPath);\nconfig.setTlsAllowInsecureConnection(false);\nconfig.setAuth(pulsar::AuthTls::create(clientPublicKeyPath, clientPrivateKeyPath));\nconfig.setValidateHostName(false);\n"))),(0,r.kt)(i.Z,{value:"Node.js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const Pulsar = require('pulsar-client');\n\n(async () => {\n  const client = new Pulsar.Client({\n    serviceUrl: 'pulsar+ssl://broker.example.com:6651/',\n    tlsTrustCertsFilePath: '/path/to/ca.cert.pem',\n    useTls: true,\n    tlsValidateHostname: false,\n    tlsAllowInsecureConnection: false,\n  });\n})();\n"))),(0,r.kt)(i.Z,{value:"C#",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"var certificate = new X509Certificate2(\"ca.cert.pem\");\nvar client = PulsarClient.Builder()\n                         .TrustedCertificateAuthority(certificate) //If the CA is not trusted on the host, you can add it explicitly.\n                         .VerifyCertificateAuthority(true) //Default is 'true'\n                         .VerifyCertificateName(false)     //Default is 'false'\n                         .Build();\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"VerifyCertificateName")," refers to the configuration of hostname verification in the C# client.")))),(0,r.kt)("h2",{id:"configure-tls-encryption-in-cli-tools"},"Configure TLS encryption in CLI tools"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools"},"Command-line tools")," like ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools#pulsar-admin"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-admin")),", ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools#pulsar-perf"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-perf")),", and ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools#pulsar-client"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-client"))," use the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf/client.conf")," config file in a Pulsar installation."),(0,r.kt)("p",null,"To use TLS encryption with the CLI tools of Pulsar, you need to add the following parameters to the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf/client.conf")," file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"webServiceUrl=https://broker.example.com:8443/\nbrokerServiceUrl=pulsar+ssl://broker.example.com:6651/\ntlsAllowInsecureConnection=false\ntlsTrustCertsFilePath=/path/to/ca.cert.pem\ntlsKeyFilePath=/path/to/client.key-pk8.pem\ntlsCertFile=/path/to/client-cert.pem\ntlsEnableHostnameVerification=false\n")),(0,r.kt)("h2",{id:"configure-tls-encryption-with-keystore"},"Configure TLS encryption with KeyStore"),(0,r.kt)("p",null,"Apache Pulsar supports ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-tls-transport"},"TLS encryption")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-tls-authentication"},"TLS authentication")," between clients and Apache Pulsar service. By default, it uses PEM format file configuration. This section tries to describe how to use ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Java_KeyStore"},"KeyStore")," type to configure TLS."),(0,r.kt)("h3",{id:"generate-tls-key-and-certificate"},"Generate TLS key and certificate"),(0,r.kt)("p",null,"The first step of deploying TLS is to generate the key and the certificate for each machine in the cluster. You can use Java\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"keytool")," utility to accomplish this task. We will generate the key into a temporary keystore initially for broker, so that we can export and sign it later with CA."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -keystore broker.keystore.jks -alias localhost -validity {validity} -genkeypair -keyalg RSA\n")),(0,r.kt)("p",null,"You need to specify two parameters in the above command:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"keystore"),": the keystore file that stores the certificate. The ",(0,r.kt)("em",{parentName:"li"},"keystore")," file contains the private key of\nthe certificate; hence, it needs to be kept safely."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"validity"),": the valid time of the certificate in days.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Ensure that common name (CN) matches exactly with the fully qualified domain name (FQDN) of the server.\nThe client compares the CN with the DNS domain name to ensure that it is indeed connecting to the desired server, not a malicious one.")),(0,r.kt)("h3",{id:"create-your-own-ca"},"Create your own CA"),(0,r.kt)("p",null,"After the first step, each broker in the cluster has a public-private key pair, and a certificate to identify the machine.\nThe certificate, however, is unsigned, which means that an attacker can create such a certificate to pretend to be any machine."),(0,r.kt)("p",null,"Therefore, it is important to prevent forged certificates by signing them for each machine in the cluster.\nA ",(0,r.kt)("inlineCode",{parentName:"p"},"certificate authority (CA)")," is responsible for signing certificates. CA works like a government that issues passports \u2014\nthe government stamps (signs) each passport so that the passport becomes difficult to forge. Other governments verify the stamps\nto ensure the passport is authentic. Similarly, the CA signs the certificates, and the cryptography guarantees that a signed\ncertificate is computationally difficult to forge. Thus, as long as the CA is a genuine and trusted authority, the clients have\nhigh assurance that they are connecting to authentic machines."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -new -x509 -keyout ca-key -out ca-cert -days 365\n")),(0,r.kt)("p",null,"The generated CA is simply a ",(0,r.kt)("em",{parentName:"p"},"public-private")," key pair and certificate, and it is intended to sign other certificates."),(0,r.kt)("p",null,"The next step is to add the generated CA to the clients' truststore so that the clients can trust this CA:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -keystore client.truststore.jks -alias CARoot -import -file ca-cert\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you configure the brokers to require client authentication by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"tlsRequireTrustedClientCertOnConnect")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," on the broker configuration, then you must also provide a truststore for the brokers and it should have all the CA certificates that clients keys were signed by.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -keystore broker.truststore.jks -alias CARoot -import -file ca-cert\n")),(0,r.kt)("p",null,"In contrast to the keystore, which stores each machine\u2019s own identity, the truststore of a client stores all the certificates\nthat the client should trust. Importing a certificate into one\u2019s truststore also means trusting all certificates that are signed\nby that certificate. As the analogy above, trusting the government (CA) also means trusting all passports (certificates) that\nit has issued. This attribute is called the chain of trust, and it is particularly useful when deploying TLS on a large BookKeeper cluster.\nYou can sign all certificates in the cluster with a single CA, and have all machines share the same truststore that trusts the CA.\nThat way all machines can authenticate all other machines."),(0,r.kt)("h3",{id:"sign-the-certificate"},"Sign the certificate"),(0,r.kt)("p",null,"The next step is to sign all certificates in the keystore with the CA we generated. "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Export the certificate from the keystore:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -keystore broker.keystore.jks -alias localhost -certreq -file cert-file\nkeytool -keystore client.keystore.jks -alias localhost -certreq -file cert-file\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Sign it with the CA:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -req -CA ca-cert -CAkey ca-key -in cert-file -out cert-signed -days {validity} -CAcreateserial -passin pass:{ca-password}\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Import both the certificate of the CA and the signed certificate into the keystore:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"keytool -keystore broker.keystore.jks -alias CARoot -import -file ca-cert\nkeytool -keystore broker.keystore.jks -alias localhost -import -file cert-signed\n\nkeytool -keystore client.keystore.jks -alias CARoot -import -file ca-cert\nkeytool -keystore client.keystore.jks -alias localhost -import -file cert-signed\n")),(0,r.kt)("p",null,"The definitions of the parameters are the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"keystore"),": the location of the keystore"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"ca-cert"),": the certificate of the CA"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"ca-key"),": the private key of the CA"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"ca-password"),": the passphrase of the CA"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"cert-file"),": the exported, unsigned certificate of the broker"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"cert-signed"),": the signed certificate of the broker")),(0,r.kt)("h3",{id:"configure-brokers-1"},"Configure brokers"),(0,r.kt)("p",null,"Brokers enable TLS by providing valid ",(0,r.kt)("inlineCode",{parentName:"p"},"brokerServicePortTls")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"webServicePortTls"),", and also set ",(0,r.kt)("inlineCode",{parentName:"p"},"tlsEnabledWithKeyStore")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," for using KeyStore type configuration. Besides this, KeyStore path,  KeyStore password, TrustStore path, and TrustStore password need to be provided. And since brokers create internal client/admin client to communicate with other brokers, users also need to provide config for them, this is similar to how users configure the outside client/admin-client. If ",(0,r.kt)("inlineCode",{parentName:"p"},"tlsRequireTrustedClientCertOnConnect")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", brokers reject the Connection if the Client Certificate is not trusted. "),(0,r.kt)("p",null,"The following TLS configs are needed on the broker side:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"brokerServicePortTls=6651\nwebServicePortTls=8081\n\ntlsRequireTrustedClientCertOnConnect=true\ntlsEnabledWithKeyStore=true\n# key store\ntlsKeyStoreType=JKS\ntlsKeyStore=/var/private/tls/broker.keystore.jks\ntlsKeyStorePassword=brokerpw\n\n# trust store\ntlsTrustStoreType=JKS\ntlsTrustStore=/var/private/tls/broker.truststore.jks\ntlsTrustStorePassword=brokerpw\n\n# internal client/admin-client config\nbrokerClientTlsEnabled=true\nbrokerClientTlsEnabledWithKeyStore=true\nbrokerClientTlsTrustStoreType=JKS\nbrokerClientTlsTrustStore=/var/private/tls/client.truststore.jks\nbrokerClientTlsTrustStorePassword=clientpw\nbrokerClientTlsKeyStoreType=JKS\nbrokerClientTlsKeyStore=/var/private/tls/client.keystore.jks\nbrokerClientTlsKeyStorePassword=clientpw\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It is important to restrict access to the store files via filesystem permissions.")),(0,r.kt)("p",null,"If you have configured TLS on the broker, to disable non-TLS ports, you can set the values of the following configurations to empty as below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-conf"},"brokerServicePort=\nwebServicePort=\n")),(0,r.kt)("p",null,"In this case, you need to set the following configurations."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"brokerClientTlsEnabled=true // Set this to true\nbrokerClientTlsEnabledWithKeyStore=true  // Set this to true\nbrokerClientTlsTrustStore= // Set this to your desired value\nbrokerClientTlsTrustStorePassword= // Set this to your desired value\n")),(0,r.kt)("p",null,"Optional settings that may worth considering:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"tlsClientAuthentication=false: Enable/Disable using TLS for authentication. This config when enabled will authenticate the other end\nof the communication channel. It should be enabled on both brokers and clients for mutual TLS."),(0,r.kt)("li",{parentName:"ol"},"tlsCiphers=","[TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256]",", A cipher suite is a named combination of authentication, encryption, MAC and key exchange\nalgorithm used to negotiate the security settings for a network connection using TLS network protocol. By default,\nit is null. ",(0,r.kt)("a",{parentName:"li",href:"https://www.openssl.org/docs/man1.0.2/apps/ciphers.html"},"OpenSSL Ciphers"),(0,r.kt)("a",{parentName:"li",href:"http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#ciphersuites"},"JDK Ciphers")),(0,r.kt)("li",{parentName:"ol"},"tlsProtocols=","[TLSv1.3,TLSv1.2]"," (list out the TLS protocols that you are going to accept from clients).\nBy default, it is not set.")),(0,r.kt)("h3",{id:"configure-clients-1"},"Configure Clients"),(0,r.kt)("p",null,"This is similar to ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/security-tls-transport#configure-clients"},"TLS encryption configurations for clients with PEM type"),".\nFor a minimal configuration, you need to provide the TrustStore information."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"for ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/reference-cli-tools"},"Command-line tools")," like ",(0,r.kt)("a",{parentName:"p",href:"reference-cli-tools#pulsar-admin"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-admin")),", ",(0,r.kt)("a",{parentName:"p",href:"reference-cli-tools#pulsar-perf"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-perf")),", and ",(0,r.kt)("a",{parentName:"p",href:"reference-cli-tools#pulsar-client"},(0,r.kt)("inlineCode",{parentName:"a"},"pulsar-client"))," use the ",(0,r.kt)("inlineCode",{parentName:"p"},"conf/client.conf")," config file in a Pulsar installation."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-properties"},"webServiceUrl=https://broker.example.com:8443/\nbrokerServiceUrl=pulsar+ssl://broker.example.com:6651/\nuseKeyStoreTls=true\ntlsTrustStoreType=JKS\ntlsTrustStorePath=/var/private/tls/client.truststore.jks\ntlsTrustStorePassword=clientpw\ntlsKeyStoreType=JKS\ntlsKeyStorePath=/var/private/tls/client.keystore.jks\nkeyStorePassword=clientpw\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"for Java client"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import org.apache.pulsar.client.api.PulsarClient;\n\nPulsarClient client = PulsarClient.builder()\n    .serviceUrl("pulsar+ssl://broker.example.com:6651/")\n    .useKeyStoreTls(true)\n    .tlsTrustStoreType("JKS")\n    .tlsTrustStorePath("/var/private/tls/client.truststore.jks")\n    .tlsTrustStorePassword("clientpw")\n    .tlsKeyStoreType("JKS")\n    .tlsKeyStorePath("/var/private/tls/client.keystore.jks")\n    .tlsKeyStorePassword("clientpw")\n    .enableTlsHostnameVerification(false) // false by default, in any case\n    .allowTlsInsecureConnection(false) // false by default, in any case\n    .build();\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"for Java admin client"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'    PulsarAdmin amdin = PulsarAdmin.builder().serviceHttpUrl("https://broker.example.com:8443")\n        .tlsTrustStoreType("JKS")\n        .tlsTrustStorePath("/var/private/tls/client.truststore.jks")\n        .tlsTrustStorePassword("clientpw")\n        .tlsKeyStoreType("JKS")\n        .tlsKeyStorePath("/var/private/tls/client.keystore.jks")\n        .tlsKeyStorePassword("clientpw")\n        .enableTlsHostnameVerification(false) // false by default, in any case\n        .allowTlsInsecureConnection(false) // false by default, in any case\n        .build();\n')))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Configure ",(0,r.kt)("inlineCode",{parentName:"p"},"tlsTrustStorePath")," when you set ",(0,r.kt)("inlineCode",{parentName:"p"},"useKeyStoreTls")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),".")),(0,r.kt)("h2",{id:"enable-tls-logging"},"Enable TLS Logging"),(0,r.kt)("p",null,"You can enable TLS debug logging at the JVM level by starting the brokers and/or clients with ",(0,r.kt)("inlineCode",{parentName:"p"},"javax.net.debug")," system property. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"-Djavax.net.debug=all\n")),(0,r.kt)("p",null,"You can find more details on this in ",(0,r.kt)("a",{parentName:"p",href:"http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html"},"Oracle documentation")," on ",(0,r.kt)("a",{parentName:"p",href:"http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html"},"debugging SSL/TLS connections"),"."))}m.isMDXComponent=!0}}]);