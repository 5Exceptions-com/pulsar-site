"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[7561],{3905:(t,e,r)=>{r.d(e,{Zo:()=>p,kt:()=>m});var n=r(67294);function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}var u=n.createContext({}),s=function(t){var e=n.useContext(u),r=e;return t&&(r="function"==typeof t?t(e):i(i({},e),t)),r},p=function(t){var e=s(t.components);return n.createElement(u.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},c=n.forwardRef((function(t,e){var r=t.components,a=t.mdxType,o=t.originalType,u=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),c=s(r),m=a,h=c["".concat(u,".").concat(m)]||c[m]||d[m]||o;return r?n.createElement(h,i(i({ref:e},p),{},{components:r})):n.createElement(h,i({ref:e},p))}));function m(t,e){var r=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var o=r.length,i=new Array(o);i[0]=c;var l={};for(var u in e)hasOwnProperty.call(e,u)&&(l[u]=e[u]);l.originalType=t,l.mdxType="string"==typeof t?t:a,i[1]=l;for(var s=2;s<o;s++)i[s]=r[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},69868:(t,e,r)=>{r.r(e),r.d(e,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=r(87462),a=(r(67294),r(3905));const o={id:"administration-proxy",title:"The Pulsar proxy",sidebar_label:"Pulsar proxy",original_id:"administration-proxy"},i=void 0,l={unversionedId:"administration-proxy",id:"version-2.1.1-incubating/administration-proxy",title:"The Pulsar proxy",description:"The Pulsar proxy is an optional gateway that you can run over the brokers in a Pulsar cluster. We recommend running a Pulsar proxy in cases when direction connections between clients and Pulsar brokers are either infeasible, undesirable, or both, for example when running Pulsar in a cloud environment or on Kubernetes or an analogous platform.",source:"@site/versioned_docs/version-2.1.1-incubating/administration-proxy.md",sourceDirName:".",slug:"/administration-proxy",permalink:"/docs/2.1.1-incubating/administration-proxy",draft:!1,editUrl:"https://github.com/apache/pulsar/edit/master/site2/docs/administration-proxy.md",tags:[],version:"2.1.1-incubating",frontMatter:{id:"administration-proxy",title:"The Pulsar proxy",sidebar_label:"Pulsar proxy",original_id:"administration-proxy"},sidebar:"version-2.1.1-incubating/docsSidebar",previous:{title:"Load distribution",permalink:"/docs/2.1.1-incubating/administration-load-distribution"},next:{title:"Overview",permalink:"/docs/2.1.1-incubating/security-overview"}},u={},s=[{value:"Running the proxy",id:"running-the-proxy",level:2},{value:"Stopping the proxy",id:"stopping-the-proxy",level:2},{value:"Proxy frontends",id:"proxy-frontends",level:2},{value:"Using Pulsar clients with the proxy",id:"using-pulsar-clients-with-the-proxy",level:2},{value:"Proxy configuration",id:"proxy-configuration",level:2}],p={toc:s};function d(t){let{components:e,...r}=t;return(0,a.kt)("wrapper",(0,n.Z)({},p,r,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"/docs/2.1.1-incubating/concepts-architecture-overview#pulsar-proxy"},"Pulsar proxy")," is an optional gateway that you can run over the brokers in a Pulsar cluster. We recommend running a Pulsar proxy in cases when direction connections between clients and Pulsar brokers are either infeasible, undesirable, or both, for example when running Pulsar in a cloud environment or on ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io"},"Kubernetes")," or an analogous platform."),(0,a.kt)("h2",{id:"running-the-proxy"},"Running the proxy"),(0,a.kt)("p",null,"In order to run the Pulsar proxy, you need to have both a local ",(0,a.kt)("a",{parentName:"p",href:"https://zookeeper.apache.org"},"ZooKeeper")," and configuration store quorum set up for use by your Pulsar cluster. For instructions, see ",(0,a.kt)("a",{parentName:"p",href:"deploy-bare-metal"},"this document"),". Once you have ZooKeeper set up and have connection strings for both ZooKeeper quorums, you can use the ",(0,a.kt)("a",{parentName:"p",href:"/docs/2.1.1-incubating/reference-cli-tools#pulsar-proxy"},(0,a.kt)("inlineCode",{parentName:"a"},"proxy"))," command of the ",(0,a.kt)("a",{parentName:"p",href:"/docs/2.1.1-incubating/reference-cli-tools#pulsar"},(0,a.kt)("inlineCode",{parentName:"a"},"pulsar"))," CLI tool to start up the proxy (preferably on its own machine or in its own VM):"),(0,a.kt)("p",null,"To start the proxy:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"\n$ cd /path/to/pulsar/directory\n$ bin/pulsar proxy \\\n  --zookeeper-servers zk-0,zk-1,zk-2 \\\n  --configuration-store-servers zk-0,zk-1,zk-2\n\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You can run as many instances of the Pulsar proxy in a cluster as you would like.")),(0,a.kt)("h2",{id:"stopping-the-proxy"},"Stopping the proxy"),(0,a.kt)("p",null,"The Pulsar proxy runs by default in the foreground. To stop the proxy, simply stop the process in which it's running."),(0,a.kt)("h2",{id:"proxy-frontends"},"Proxy frontends"),(0,a.kt)("p",null,"We recommend running the Pulsar proxy behind some kind of load-distributing frontend, such as an ",(0,a.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/an-introduction-to-haproxy-and-load-balancing-concepts"},"HAProxy")," load balancer."),(0,a.kt)("h2",{id:"using-pulsar-clients-with-the-proxy"},"Using Pulsar clients with the proxy"),(0,a.kt)("p",null,"Once your Pulsar proxy is up and running, preferably behind a load-distributing ",(0,a.kt)("a",{parentName:"p",href:"#proxy-frontends"},"frontend"),", clients can connect to the proxy via whichever address is used by the frontend. If the address were the DNS address ",(0,a.kt)("inlineCode",{parentName:"p"},"pulsar.cluster.default"),", for example, then the connection URL for clients would be ",(0,a.kt)("inlineCode",{parentName:"p"},"pulsar://pulsar.cluster.default:6650"),"."),(0,a.kt)("h2",{id:"proxy-configuration"},"Proxy configuration"),(0,a.kt)("p",null,"The Pulsar proxy can be configured using the ",(0,a.kt)("a",{parentName:"p",href:"/docs/2.1.1-incubating/reference-configuration#proxy"},(0,a.kt)("inlineCode",{parentName:"a"},"proxy.conf"))," configuration file. The following parameters are available in that file:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"zookeeperServers"),(0,a.kt)("td",{parentName:"tr",align:null},"The ZooKeeper quorum connection string (as a comma-separated list)"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"configurationStoreServers"),(0,a.kt)("td",{parentName:"tr",align:null},"Configuration store connection string (as a comma-separated list)"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"zookeeperSessionTimeoutMs"),(0,a.kt)("td",{parentName:"tr",align:null},"ZooKeeper session timeout (in milliseconds)"),(0,a.kt)("td",{parentName:"tr",align:null},"30000")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"servicePort"),(0,a.kt)("td",{parentName:"tr",align:null},"The port to use for server binary Protobuf requests"),(0,a.kt)("td",{parentName:"tr",align:null},"6650")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"servicePortTls"),(0,a.kt)("td",{parentName:"tr",align:null},"The port to use to server binary Protobuf TLS requests"),(0,a.kt)("td",{parentName:"tr",align:null},"6651")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"statusFilePath"),(0,a.kt)("td",{parentName:"tr",align:null},"Path for the file used to determine the rotation status for the proxy instance when responding to service discovery health checks"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"authenticationEnabled"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether authentication is enabled for the Pulsar proxy"),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"authenticationProviders"),(0,a.kt)("td",{parentName:"tr",align:null},"Authentication provider name list (a comma-separated list of class names)"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"authorizationEnabled"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether authorization is enforced by the Pulsar proxy"),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"authorizationProvider"),(0,a.kt)("td",{parentName:"tr",align:null},"Authorization provider as a fully qualified class name"),(0,a.kt)("td",{parentName:"tr",align:null},"org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"brokerClientAuthenticationPlugin"),(0,a.kt)("td",{parentName:"tr",align:null},"The authentication plugin used by the Pulsar proxy to authenticate with Pulsar brokers"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"brokerClientAuthenticationParameters"),(0,a.kt)("td",{parentName:"tr",align:null},"The authentication parameters used by the Pulsar proxy to authenticate with Pulsar brokers"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"brokerClientTrustCertsFilePath"),(0,a.kt)("td",{parentName:"tr",align:null},"The path to trusted certificates used by the Pulsar proxy to authenticate with Pulsar brokers"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"superUserRoles"),(0,a.kt)("td",{parentName:"tr",align:null},"Role names that are treated as \u201csuper-users,\u201d meaning that they will be able to perform all admin"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"forwardAuthorizationCredentials"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether client authorization credentials are forwarded to the broker for re-authorization. Authentication must be enabled via authenticationEnabled=true for this to take effect."),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"maxConcurrentInboundConnections"),(0,a.kt)("td",{parentName:"tr",align:null},"Max concurrent inbound connections. The proxy will reject requests beyond that."),(0,a.kt)("td",{parentName:"tr",align:null},"10000")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"maxConcurrentLookupRequests"),(0,a.kt)("td",{parentName:"tr",align:null},"Max concurrent outbound connections. The proxy will error out requests beyond that."),(0,a.kt)("td",{parentName:"tr",align:null},"50000")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsEnabledInProxy"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether TLS is enabled for the proxy"),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsEnabledWithBroker"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether TLS is enabled when communicating with Pulsar brokers"),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsCertificateFilePath"),(0,a.kt)("td",{parentName:"tr",align:null},"Path for the TLS certificate file"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsKeyFilePath"),(0,a.kt)("td",{parentName:"tr",align:null},"Path for the TLS private key file"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsTrustCertsFilePath"),(0,a.kt)("td",{parentName:"tr",align:null},"Path for the trusted TLS certificate pem file"),(0,a.kt)("td",{parentName:"tr",align:null})),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsHostnameVerificationEnabled"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether the hostname is validated when the proxy creates a TLS connection with brokers"),(0,a.kt)("td",{parentName:"tr",align:null},"false")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"tlsRequireTrustedClientCertOnConnect"),(0,a.kt)("td",{parentName:"tr",align:null},"Whether client certificates are required for TLS. Connections are rejected if the client certificate isn\u2019t trusted."),(0,a.kt)("td",{parentName:"tr",align:null},"false")))))}d.isMDXComponent=!0}}]);