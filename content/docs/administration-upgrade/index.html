<!doctype html>
<html class="docs-version-2.9.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Apache Pulsar" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;400;600&display=swap">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">Upgrade Guide | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.org/docs/administration-upgrade"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="2.9.1"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-2.9.1"><meta data-react-helmet="true" property="og:title" content="Upgrade Guide | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Upgrade guidelines"><meta data-react-helmet="true" property="og:description" content="Upgrade guidelines"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.org/docs/administration-upgrade"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/docs/administration-upgrade" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/zh-CN/docs/administration-upgrade" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/zh-TW/docs/administration-upgrade" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/ja/docs/administration-upgrade" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/fr/docs/administration-upgrade" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/ko/docs/administration-upgrade" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.org/docs/administration-upgrade" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.699273c6.css">
<link rel="preload" href="/assets/js/runtime~main.2a44c0ba.js" as="script">
<link rel="preload" href="/assets/js/main.592b7927.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/docs/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link navbar__link--active" href="/docs/about">Quickstart</a></li><li><a class="dropdown__link" href="/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/docs/about">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/community#governance">Governance</a></li><li><a class="dropdown__link" href="/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog">Blog</a></li><li><a class="dropdown__link" href="/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/resources">Resources</a></li><li><a class="dropdown__link" href="/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh-CN/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（中国）</a></li><li><a href="/zh-TW/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link">中文（台灣）</a></li><li><a href="/ja/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/fr/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link">Français</a></li><li><a href="/ko/docs/administration-upgrade" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.0</span></a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/about">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/concepts-overview">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/schema-get-started">Pulsar Schema</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/functions-overview">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/io-overview">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/sql-overview">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/tiered-storage-overview">Tiered Storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/txn-why">Transactions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/helm-overview">Kubernetes (Helm)</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/deploy-aws">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/administration-zk-bk">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-geo">Geo-replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-pulsar-manager">Pulsar Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-stats">Pulsar statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-load-balance">Load balance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-proxy">Pulsar proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/administration-upgrade">Upgrade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/administration-isolation">Pulsar isolation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/security-overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/performance-pulsar-perf">Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/client-libraries">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/admin-api-overview">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/adaptors-kafka">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/cookbooks-compaction">Cookbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/develop-tools">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/reference-terminology">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.9.1</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrade Guide</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-guidelines">Upgrade guidelines<a class="hash-link" href="#upgrade-guidelines" title="Direct link to heading">​</a></h2><p>Apache Pulsar is comprised of multiple components, ZooKeeper, bookies, and brokers. These components are either stateful or stateless. You do not have to upgrade ZooKeeper nodes unless you have special requirement. While you upgrade, you need to pay attention to bookies (stateful), brokers and proxies (stateless).</p><p>The following are some guidelines on upgrading a Pulsar cluster. Read the guidelines before upgrading.</p><ul><li>Backup all your configuration files before upgrading.</li><li>Read guide entirely, make a plan, and then execute the plan. When you make upgrade plan, you need to take your specific requirements and environment into consideration.   </li><li>Pay attention to the upgrading order of components. In general, you do not need to upgrade your ZooKeeper or configuration store cluster (the global ZooKeeper cluster). You need to upgrade bookies first, and then upgrade brokers, proxies, and your clients. </li><li>If <code>autorecovery</code> is enabled, you need to disable <code>autorecovery</code> in the upgrade process, and re-enable it after completing the process.</li><li>Read the release notes carefully for each release. Release notes contain features, configuration changes that might impact your upgrade.</li><li>Upgrade a small subset of nodes of each type to canary test the new version before upgrading all nodes of that type in the cluster. When you have upgraded the canary nodes, run for a while to ensure that they work correctly.</li><li>Upgrade one data center to verify new version before upgrading all data centers if your cluster runs in multi-cluster replicated mode.</li></ul><blockquote><p>Note: Currently, Apache Pulsar is compatible between versions. </p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-sequence">Upgrade sequence<a class="hash-link" href="#upgrade-sequence" title="Direct link to heading">​</a></h2><p>To upgrade an Apache Pulsar cluster, follow the upgrade sequence.</p><ol><li>Upgrade ZooKeeper (optional)  </li></ol><ul><li>Canary test: test an upgraded version in one or a small set of ZooKeeper nodes.  </li><li>Rolling upgrade: rollout the upgraded version to all ZooKeeper servers incrementally, one at a time. Monitor your dashboard during the whole rolling upgrade process.</li></ul><ol start="2"><li>Upgrade bookies  </li></ol><ul><li><p>Canary test: test an upgraded version in one or a small set of bookies.</p></li><li><p>Rolling upgrade:  </p><ul><li><p>a. Disable <code>autorecovery</code> with the following command.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/bookkeeper shell autorecovery -disable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><ul><li><p>b. Rollout the upgraded version to all bookies in the cluster after you determine that a version is safe after canary.  </p></li><li><p>c. After you upgrade all bookies, re-enable <code>autorecovery</code> with the following command.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/bookkeeper shell autorecovery -enable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul></li></ul><ol start="3"><li>Upgrade brokers</li></ol><ul><li>Canary test: test an upgraded version in one or a small set of brokers.</li><li>Rolling upgrade: rollout the upgraded version to all brokers in the cluster after you determine that a version is safe after canary.</li></ul><ol start="4"><li>Upgrade proxies</li></ol><ul><li>Canary test: test an upgraded version in one or a small set of proxies.</li><li>Rolling upgrade: rollout the upgraded version to all proxies in the cluster after you determine that a version is safe after canary.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-zookeeper-optional">Upgrade ZooKeeper (optional)<a class="hash-link" href="#upgrade-zookeeper-optional" title="Direct link to heading">​</a></h2><p>While you upgrade ZooKeeper servers, you can do canary test first, and then upgrade all ZooKeeper servers in the cluster.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="canary-test">Canary test<a class="hash-link" href="#canary-test" title="Direct link to heading">​</a></h3><p>You can test an upgraded version in one of ZooKeeper servers before upgrading all ZooKeeper servers in your cluster.</p><p>To upgrade ZooKeeper server to a new version, complete the following steps:</p><ol><li>Stop a ZooKeeper server.</li><li>Upgrade the binary and configuration files.</li><li>Start the ZooKeeper server with the new binary files.</li><li>Use <code>pulsar zookeeper-shell</code> to connect to the newly upgraded ZooKeeper server and run a few commands to verify if it works as expected.</li><li>Run the ZooKeeper server for a few days, observe and make sure the ZooKeeper cluster runs well.</li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="canary-rollback">Canary rollback<a class="hash-link" href="#canary-rollback" title="Direct link to heading">​</a></h4><p>If issues occur during canary test, you can shut down the problematic ZooKeeper node, revert the binary and configuration, and restart the ZooKeeper with the reverted binary.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-all-zookeeper-servers">Upgrade all ZooKeeper servers<a class="hash-link" href="#upgrade-all-zookeeper-servers" title="Direct link to heading">​</a></h3><p>After canary test to upgrade one ZooKeeper in your cluster, you can upgrade all ZooKeeper servers in your cluster. </p><p>You can upgrade all ZooKeeper servers one by one by following steps in canary test.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-bookies">Upgrade bookies<a class="hash-link" href="#upgrade-bookies" title="Direct link to heading">​</a></h2><p>While you upgrade bookies, you can do canary test first, and then upgrade all bookies in the cluster.
For more details, you can read Apache BookKeeper <a href="http://bookkeeper.apache.org/docs/latest/admin/upgrade" target="_blank" rel="noopener noreferrer">Upgrade guide</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="canary-test-1">Canary test<a class="hash-link" href="#canary-test-1" title="Direct link to heading">​</a></h3><p>You can test an upgraded version in one or a small set of bookies before upgrading all bookies in your cluster.</p><p>To upgrade bookie to a new version, complete the following steps:</p><ol><li><p>Stop a bookie.</p></li><li><p>Upgrade the binary and configuration files.</p></li><li><p>Start the bookie in <code>ReadOnly</code> mode to verify if the bookie of this new version runs well for read workload.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar bookie --readOnly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>When the bookie runs successfully in <code>ReadOnly</code> mode, stop the bookie and restart it in <code>Write/Read</code> mode.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar bookie</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Observe and make sure the cluster serves both write and read traffic.</p></li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="canary-rollback-1">Canary rollback<a class="hash-link" href="#canary-rollback-1" title="Direct link to heading">​</a></h4><p>If issues occur during the canary test, you can shut down the problematic bookie node. Other bookies in the cluster replaces this problematic bookie node with autorecovery. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-all-bookies">Upgrade all bookies<a class="hash-link" href="#upgrade-all-bookies" title="Direct link to heading">​</a></h3><p>After canary test to upgrade some bookies in your cluster, you can upgrade all bookies in your cluster. </p><p>Before upgrading, you have to decide whether to upgrade the whole cluster at once, including downtime and rolling upgrade scenarios.</p><p>In a rolling upgrade scenario, upgrade one bookie at a time. In a downtime upgrade scenario, shut down the entire cluster, upgrade each bookie, and then start the cluster.</p><p>While you upgrade in both scenarios, the procedure is the same for each bookie.</p><ol><li>Stop the bookie. </li><li>Upgrade the software (either new binary or new configuration files).</li><li>Start the bookie.</li></ol><blockquote><p><strong>Advanced operations</strong><br>
<!-- -->When you upgrade a large BookKeeper cluster in a rolling upgrade scenario, upgrading one bookie at a time is slow. If you configure rack-aware or region-aware placement policy, you can upgrade bookies rack by rack or region by region, which speeds up the whole upgrade process.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-brokers-and-proxies">Upgrade brokers and proxies<a class="hash-link" href="#upgrade-brokers-and-proxies" title="Direct link to heading">​</a></h2><p>The upgrade procedure for brokers and proxies is the same. Brokers and proxies are <code>stateless</code>, so upgrading the two services is easy.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="canary-test-2">Canary test<a class="hash-link" href="#canary-test-2" title="Direct link to heading">​</a></h3><p>You can test an upgraded version in one or a small set of nodes before upgrading all nodes in your cluster.</p><p>To upgrade to a new version, complete the following steps:</p><ol><li>Stop a broker (or proxy).</li><li>Upgrade the binary and configuration file.</li><li>Start a broker (or proxy).</li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="canary-rollback-2">Canary rollback<a class="hash-link" href="#canary-rollback-2" title="Direct link to heading">​</a></h4><p>If issues occur during canary test, you can shut down the problematic broker (or proxy) node. Revert to the old version and restart the broker (or proxy).</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="upgrade-all-brokers-or-proxies">Upgrade all brokers or proxies<a class="hash-link" href="#upgrade-all-brokers-or-proxies" title="Direct link to heading">​</a></h3><p>After canary test to upgrade some brokers or proxies in your cluster, you can upgrade all brokers or proxies in your cluster. </p><p>Before upgrading, you have to decide whether to upgrade the whole cluster at once, including downtime and rolling upgrade scenarios.</p><p>In a rolling upgrade scenario, you can upgrade one broker or one proxy at a time if the size of the cluster is small. If your cluster is large, you can upgrade brokers or proxies in batches. When you upgrade a batch of brokers or proxies, make sure the remaining brokers and proxies in the cluster have enough capacity to handle the traffic during upgrade.</p><p>In a downtime upgrade scenario, shut down the entire cluster, upgrade each broker or proxy, and then start the cluster.</p><p>While you upgrade in both scenarios, the procedure is the same for each broker or proxy.</p><ol><li>Stop the broker or proxy. </li><li>Upgrade the software (either new binary or new configuration files).</li><li>Start the broker or proxy.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.9.1/administration-upgrade.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/administration-proxy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pulsar proxy</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/administration-isolation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pulsar isolation</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#upgrade-guidelines" class="table-of-contents__link toc-highlight">Upgrade guidelines</a></li><li><a href="#upgrade-sequence" class="table-of-contents__link toc-highlight">Upgrade sequence</a></li><li><a href="#upgrade-zookeeper-optional" class="table-of-contents__link toc-highlight">Upgrade ZooKeeper (optional)</a><ul><li><a href="#canary-test" class="table-of-contents__link toc-highlight">Canary test</a></li><li><a href="#upgrade-all-zookeeper-servers" class="table-of-contents__link toc-highlight">Upgrade all ZooKeeper servers</a></li></ul></li><li><a href="#upgrade-bookies" class="table-of-contents__link toc-highlight">Upgrade bookies</a><ul><li><a href="#canary-test-1" class="table-of-contents__link toc-highlight">Canary test</a></li><li><a href="#upgrade-all-bookies" class="table-of-contents__link toc-highlight">Upgrade all bookies</a></li></ul></li><li><a href="#upgrade-brokers-and-proxies" class="table-of-contents__link toc-highlight">Upgrade brokers and proxies</a><ul><li><a href="#canary-test-2" class="table-of-contents__link toc-highlight">Canary test</a></li><li><a href="#upgrade-all-brokers-or-proxies" class="table-of-contents__link toc-highlight">Upgrade all brokers or proxies</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.2a44c0ba.js"></script>
<script src="/assets/js/main.592b7927.js"></script>
</body>
</html>